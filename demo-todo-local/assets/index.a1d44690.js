var te=Object.defineProperty,se=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var R=(t,e,s)=>e in t?te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,y=(t,e)=>{for(var s in e||(e={}))ne.call(e,s)&&R(t,s,e[s]);if(B)for(var s of B(e))oe.call(e,s)&&R(t,s,e[s]);return t},A=(t,e)=>se(t,re(e));var u=(t,e,s)=>(R(t,typeof e!="symbol"?e+"":e,s),s);import{n as ie,t as C,i as ae,a as x,h as ue,r as I,K as ce,c as de,b as v,g as M,o as le,e as fe,d as _,f as g,w as J,v as he,j as b,k as S,l as O,m as pe,p as m,F as w,q as me,s as ye,u as ge,x as ve,y as be,z as D,A as we}from"./vendor.f34b366c.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};$e();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},T=new Map;function qe(t,e){const s=new q;t.provide(q.key,s),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const o=this.$.render;this.$.render=function(...i){let a=o.apply(this,i);const l={},f={};for(const[d,h]of Object.entries(C(this.$.data)))ae(h)&&h.value&&h.value.data&&((h.value.stale?f:l)[d]=h.value.data);return Object.keys(f).length===0&&Object.keys(l).length===0||((!x(a)||typeof a.type!="string")&&(a=ue(c.wrapperComponent||"div",a)),c.hydrate)||(a.props||(a.props={}),a.props["data-dehydrated"]=JSON.stringify(l),a.props["data-stale"]=JSON.stringify(f)),a}}const n=this.$.type;let r=n.instanceCount;r||(r=n.instanceCount=I(0)),r.value++},beforeMount(){var i,a,l,f;if(!c.hydrate)return;const n=C(this.$.data),r=JSON.parse(((a=(i=this.$el)==null?void 0:i.dataset)==null?void 0:a.dehydrated)||"{}"),o=JSON.parse(((f=(l=this.$el)==null?void 0:l.dataset)==null?void 0:f.stale)||"{}");for(const d of Object.keys(o))n[d].value._query&&n[d].value._query.refresh();for(const[d,h]of Object.entries(y(y({},r),o)))n[d].__query_ref__?n[d].__query_ref__.value={loading:!1,data:[h]}:n[d].value={loading:!1,data:h}},async serverPrefetch(){await s.flushing},unmounted(){this.$.type.instanceCount.value--}})}function K(t){return Q(t.$).proxy}function Q(t){return!t.parent||t.parent.type===ce?t:Q(t.parent)}function j(t,e){if(t instanceof p){const s=W(t,e),n=de(()=>{const r=s.value;return{loading:r.loading,data:r.data[0],error:r.error}});return n.__query_ref__=s,n}return E(t,e)[0]}function E(t,e){if(t instanceof p)return W(t,e);const s=t;s.instanceCount||(s.instanceCount=I(0)),s.instanceCount.value;const n=[];let r;if(e.$parent)r=e.$parent.$.subTree;else if(e.$root)r=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return L(n,r,s,e),n}function L(t,e,s,n){if(!!e){if(e.component)e.type===s&&_e(e.component.proxy,n)&&t.push(e.component.proxy),L(t,e.component.subTree,s,n);else if(Array.isArray(e.children))for(const r of e.children)x(r)&&L(t,r,s,n)}}function _e(t,e){if(!e)return!0;for(const[s,n]of Object.entries(e))if(s==="$parent"){if(t.$.parent.proxy!==n)return!1}else if(t[s]!==n)return!1;return!0}function Re(t,e,...s){const n=t.$;H(!0,e,s,n)}function z(t,e,s){if(s.component)H(!1,t,e,s.component);else if(Array.isArray(s.children))for(const n of s.children)x(n)&&z(t,e,n)}function H(t,e,s,n){const r=n.proxy;!t&&r[e]?r[e].apply(r,s):z(e,s,n.subTree)}function $(){return new Promise(t=>ie(t))}async function N(t){return new Promise(e=>setTimeout(e,t))}function U(t,e){if(e instanceof p)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function ke(t,e){return v(new p(t,e))}class p{constructor(e,s){u(this,"pickedFields");u(this,"subResources",{});this.table=e,this.options=s}clone(){const e=new p(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=y({},this.subResources),e}pick(...e){const s=this.clone();return s.pickedFields=e,v(s)}load(e,s,n,r){const o=this.clone();return o.subResources[e]={single:!0,resource:s,dynamicCriteria:n,staticCriteria:r==null?void 0:r.staticCriteria},v(o)}query(e,s,n,r){const o=this.clone();return o.subResources[e]={resource:s,dynamicCriteria:n,staticCriteria:r==null?void 0:r.staticCriteria},v(o)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function W(t,e){const s=new Ce(C(t),e);return M().scope.run(()=>{const n=G(t);n.forEach(r=>F(r).add(s)),le(()=>{n.forEach(r=>F(r).delete(s))})}),s.result}function F(t){let e=T.get(t);return e||T.set(t,e=new Set),e}function G(t){var s;let e=((s=t.options)==null?void 0:s.sourceTables)?[t.table,...t.options.sourceTables]:[t.table];for(const n of Object.values(t.subResources))e=[...e,...G(n.resource)];return e}class q{constructor(){u(this,"buffered",[]);u(this,"flushing")}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await $();const e=this.buffered;this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}}u(q,"key",Symbol());class Ce{constructor(e,s){u(this,"result",I({loading:!1,data:[],error:void 0,_query:this}));u(this,"criteria",{});u(this,"version",0);u(this,"queryBuffer");this.resource=e;const n=M();if(this.queryBuffer=n.appContext.provides[q.key],!this.queryBuffer)throw new Error("please add app.use(vdb) to install vue-db before query");fe(()=>{s&&(this.criteria=s()),c.hydrate&&!n.isMounted||this.queryBuffer.execute(this.newRequest(!n.isMounted))})}newRequest(e){return this.version++,new X(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class X{constructor(e,s){u(this,"baseVersion");u(this,"criteria");u(this,"showingLoading");this.query=e,this.showLoading=s,this.baseVersion=e.version,this.criteria=e.criteria,s&&!c.dehydrate&&(c.loadingPreDelay?N(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await N(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,s){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,s)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:s}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}function Y(t){let e=this&&this.Resource!==p?this:void 0;return{as(s){const n=r=>{const o=[];for(const l of t.affectedTables){const f=T.get(l);for(const d of f||[])o.push(d.newRequest())}const i=t.command||s,a=new Z(i,r);return c.rpcProvider(o,a),a.promise};return A(y({},e),{[s]:n,defineCommand:Y})}}}class Z{constructor(e,s){u(this,"promise");u(this,"resolve");u(this,"reject");u(this,"responded",!1);this.command=e,this.args=s,this.promise=new Promise((n,r)=>{this.resolve=o=>{this.responded||(this.responded=!0,n(o))},this.reject=o=>{this.responded||(this.responded=!0,r(o))}})}toJSON(){return{command:this.command,args:this.args}}}var Oe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:qe,pageOf:K,load:j,query:E,walk:Re,waitNextTick:$,sleep:N,castTo:U,defineResource:ke,Resource:p,QueryRequest:X,defineCommand:Y,CommandRequest:Z}),P=(t,e)=>{const s=t.__vccOpts||t;for(const[n,r]of e)s[n]=r;return s};const Te=_({props:{itemId:{type:String,required:!0}},data(){return{visible:!1,content:"",completed:!1}},methods:{init(t){this.visible=!0,this.content=t},onRemove(){U(this.$parent,V).remove(this.itemId)}}}),Le={key:0};function Ne(t,e,s,n,r,o){return t.visible?(m(),g("div",Le,[J(b("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.completed=i)},null,512),[[he,t.completed]]),S(" "+O(t.content)+" ",1),b("button",{onClick:e[1]||(e[1]=(...i)=>t.onRemove&&t.onRemove(...i))},"x")])):pe("",!0)}var k=P(Te,[["render",Ne]]);const xe=_({components:{TodoListItem:k},data(){return{itemIds:[]}},computed:{completedCount(){let t=0;for(const e of E(k,{$parent:this}))e.completed&&t++;return t}},methods:{async add(){const t=`${new Date().getTime()}`;return this.itemIds.push(t),await $(),j(k,{$parent:this,itemId:t})},async remove(t){const e=this.itemIds.indexOf(t);e!==-1&&(this.itemIds.splice(e,1),await $())}}});function Ie(t,e,s,n,r,o){const i=ye("TodoListItem");return m(),g(w,null,[S(O(t.completedCount)+" out of "+O(t.itemIds.length)+" items completed ",1),(m(!0),g(w,null,me(t.itemIds,a=>(m(),ge(i,{key:a,itemId:a},null,8,["itemId"]))),128))],64)}var V=P(xe,[["render",Ie]]);const Se=_({data(){return{content:""}},methods:{async onEnter(){if(!this.content)return;(await j(V,{$root:K(this)}).add()).init(this.content),this.content=""}}}),je=S(" What needs to be done? ");function Ee(t,e,s,n,r,o){return m(),g(w,null,[je,J(b("input",{type:"textbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.content=i),onKeyup:e[1]||(e[1]=be((...i)=>t.onEnter&&t.onEnter(...i),["enter"]))},null,544),[[ve,t.content]])],64)}var Pe=P(Se,[["render",Ee]]);const Ve=b("h1",null,"To-Do List",-1),Be=_({setup(t){return(e,s)=>(m(),g(w,null,[Ve,D(Pe),D(V)],64))}}),ee=we(Be);ee.use(Oe);ee.mount("#app");
