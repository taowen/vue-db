var W=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var g=(t,e,r)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e)=>{for(var r in e||(e={}))Z.call(e,r)&&g(t,r,e[r]);if(F)for(var r of F(e))ee.call(e,r)&&g(t,r,e[r]);return t},j=(t,e)=>X(t,Y(e));var a=(t,e,r)=>(g(t,typeof e!="symbol"?e+"":e,r),r);import{t as w,i as te,a as O,h as re,r as S,K as se,c as ne,n as oe,b as m,g as P,o as ie,e as ae,d as N,f as E,j as b,k as q,w as ue,v as ce,l as T,m as le,p as x,q as de,s as fe,u as he,x as pe}from"./vendor.e6e42be5.js";const ye=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};ye();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},$=new Map;function me(t,e){const r=new v;t.provide(v.key,r),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const o=this.$.render;this.$.render=function(...u){let i=o.apply(this,u);const d={},f={};for(const[l,h]of Object.entries(w(this.$.data)))te(h)&&h.value&&h.value.data&&((h.value.stale?f:d)[l]=h.value.data);return Object.keys(f).length===0&&Object.keys(d).length===0||((!O(i)||typeof i.type!="string")&&(i=re(c.wrapperComponent||"div",i)),c.hydrate)||(i.props||(i.props={}),i.props["data-dehydrated"]=JSON.stringify(d),i.props["data-stale"]=JSON.stringify(f)),i}}const n=this.$.type;let s=n.instanceCount;s||(s=n.instanceCount=S(0)),s.value++},beforeMount(){var u,i,d,f;if(!c.hydrate)return;const n=w(this.$.data),s=JSON.parse(((i=(u=this.$el)==null?void 0:u.dataset)==null?void 0:i.dehydrated)||"{}"),o=JSON.parse(((f=(d=this.$el)==null?void 0:d.dataset)==null?void 0:f.stale)||"{}");for(const l of Object.keys(o))n[l].value._query&&n[l].value._query.refresh();for(const[l,h]of Object.entries(y(y({},s),o)))n[l].__query_ref__?n[l].__query_ref__.value={loading:!1,data:[h]}:n[l].value={loading:!1,data:h}},async serverPrefetch(){await r.flushing},unmounted(){this.$.type.instanceCount.value--}})}function be(t){return I(t.$).proxy}function I(t){return!t.parent||t.parent.type===se?t:I(t.parent)}function R(t,e){if(t instanceof p){const r=J(t,e),n=ne(()=>{const s=r.value;return{loading:s.loading,data:s.data[0],error:s.error}});return n.__query_ref__=r,n}return B(t,e)[0]}function B(t,e){if(t instanceof p)return J(t,e);const r=t;r.instanceCount||(r.instanceCount=S(0)),r.instanceCount.value;const n=[];let s;if(e.$parent)s=e.$parent.$.subTree;else if(e.$root)s=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return k(n,s,r,e),n}function k(t,e,r,n){if(!!e){if(e.component)e.type===r&&ve(e.component.proxy,n)&&t.push(e.component.proxy),k(t,e.component.subTree,r,n);else if(Array.isArray(e.children))for(const s of e.children)O(s)&&k(t,s,r,n)}}function ve(t,e){if(!e)return!0;for(const[r,n]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==n)return!1}else if(t[r]!==n)return!1;return!0}function V(t,e,...r){const n=t.$;M(!0,e,r,n)}function A(t,e,r){if(r.component)M(!1,t,e,r.component);else if(Array.isArray(r.children))for(const n of r.children)O(n)&&A(t,e,n)}function M(t,e,r,n){const s=n.proxy;!t&&s[e]?s[e].apply(s,r):A(e,r,n.subTree)}function D(){return new Promise(t=>oe(t))}async function C(t){return new Promise(e=>setTimeout(e,t))}function ge(t,e){if(e instanceof p)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function _e(t,e){return m(new p(t,e))}class p{constructor(e,r){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new p(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=y({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,m(r)}load(e,r,n,s){const o=this.clone();return o.subResources[e]={single:!0,resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},m(o)}query(e,r,n,s){const o=this.clone();return o.subResources[e]={resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},m(o)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function J(t,e){const r=new we(w(t),e);return P().scope.run(()=>{const n=Q(t);n.forEach(s=>L(s).add(r)),ie(()=>{n.forEach(s=>L(s).delete(r))})}),r.result}function L(t){let e=$.get(t);return e||$.set(t,e=new Set),e}function Q(t){var r;let e=((r=t.options)==null?void 0:r.sourceTables)?[t.table,...t.options.sourceTables]:[t.table];for(const n of Object.values(t.subResources))e=[...e,...Q(n.resource)];return e}class v{constructor(){a(this,"buffered",[]);a(this,"flushing")}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await D();const e=this.buffered;this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}}a(v,"key",Symbol());class we{constructor(e,r){a(this,"result",S({loading:!1,data:[],error:void 0,_query:this}));a(this,"criteria",{});a(this,"version",0);a(this,"queryBuffer");this.resource=e;const n=P();if(this.queryBuffer=n.appContext.provides[v.key],!this.queryBuffer)throw new Error("please add app.use(vdb) to install vue-db before query");ae(()=>{r&&(this.criteria=r()),c.hydrate&&!n.isMounted||this.queryBuffer.execute(this.newRequest(!n.isMounted))})}newRequest(e){return this.version++,new H(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class H{constructor(e,r){a(this,"baseVersion");a(this,"criteria");a(this,"showingLoading");this.query=e,this.showLoading=r,this.baseVersion=e.version,this.criteria=e.criteria,r&&!c.dehydrate&&(c.loadingPreDelay?C(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await C(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,r){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,r)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:r}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}function K(t){let e=this&&this.Resource!==p?this:void 0;return{as(r){const n=s=>{const o=[];for(const d of t.affectedTables){const f=$.get(d);for(const l of f||[])o.push(l.newRequest())}const u=t.command||r,i=new U(u,s);return c.rpcProvider(o,i),i.promise};return j(y({},e),{[r]:n,defineCommand:K})}}}class U{constructor(e,r){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((n,s)=>{this.resolve=o=>{this.responded||(this.responded=!0,n(o))},this.reject=o=>{this.responded||(this.responded=!0,s(o))}})}toJSON(){return{command:this.command,args:this.args}}}var qe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:me,pageOf:be,load:R,query:B,walk:V,waitNextTick:D,sleep:C,castTo:ge,defineResource:_e,Resource:p,QueryRequest:H,defineCommand:K,CommandRequest:U});var z=(t,e)=>{const r=t.__vccOpts||t;for(const[n,s]of e)r[n]=s;return r};let $e=1;const Re=N({props:{name:{required:!0,type:String},label:{default:""},type:{default:"text"}},data(){return{inputId:`input${$e++}`,value:""}},methods:{fillForm(t){t[this.name]=this.value}}}),ke={class:"row"},Ce=["for"],Oe=["id","type","name"];function Se(t,e,r,n,s,o){return T(),E("div",ke,[b("label",{for:t.inputId},q(t.label),9,Ce),ue(b("input",{id:t.inputId,"onUpdate:modelValue":e[0]||(e[0]=u=>t.value=u),type:t.type,name:t.name},null,8,Oe),[[ce,t.value]])])}var _=z(Re,[["render",Se],["__scopeId","data-v-20bc85b6"]]);const Ne=N({components:{InputField:_},computed:{username(){var t;return(t=R(_,{$parent:this,name:"username"}))==null?void 0:t.value},hobby(){var t;return(t=R(_,{$parent:this,name:"hobby"}))==null?void 0:t.value}},methods:{onSubmit(){const t={};V(this,"fillForm",t),console.log("!!! submit",t)}}});function Te(t,e,r,n,s,o){const u=le("InputField");return T(),E("form",null,[b("fieldset",null,[x(u,{label:"User Name:",name:"username"}),x(u,{label:"Hobby:",name:"hobby"}),b("button",{type:"submit",onClick:e[0]||(e[0]=de((...i)=>t.onSubmit&&t.onSubmit(...i),["prevent"]))},"submit"),fe(" hello "+q(t.username||"[username]")+", who likes "+q(t.hobby||"[hobby]"),1)])])}var Fe=z(Ne,[["render",Te],["__scopeId","data-v-554f00a0"]]);const je=N({setup(t){return(e,r)=>(T(),he(Fe))}}),G=pe(je);G.use(qe);G.mount("#app");
