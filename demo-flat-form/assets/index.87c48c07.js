var G=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var g=(t,e,r)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h=(t,e)=>{for(var r in e||(e={}))Y.call(e,r)&&g(t,r,e[r]);if(x)for(var r of x(e))Z.call(e,r)&&g(t,r,e[r]);return t},L=(t,e)=>W(t,X(e));var a=(t,e,r)=>(g(t,typeof e!="symbol"?e+"":e,r),r);import{i as O,h as ee,t as _,a as te,r as j,g as N,e as T,K as re,c as se,n as ne,b as m,o as ie,d as S,f as I,j as v,k as q,w as oe,v as ae,l as F,m as ue,p as P,q as ce,s as le,u as de,x as fe}from"./vendor.3e4ef62c.js";const he=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};he();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},$=new Map;function pe(t,e){y.provide(t),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const n=this.$.render;this.$.render=function(...i){let o=n.apply(this,i);if((!O(o)||typeof o.type!="string")&&(o=ee("div",o)),c.hydrate)return o;o.props||(o.props={});const u={},f={};for(const[b,d]of Object.entries(_(this.$.data)))te(d)&&d.value&&d.value.data&&((d.value.stale?f:u)[b]=d.value.data);return o.props["data-dehydrated"]=JSON.stringify(u),o.props["data-stale"]=JSON.stringify(f),o}}const r=this.$.type;let s=r.instanceCount;s||(s=r.instanceCount=j(0)),s.value++},beforeMount(){var i,o;if(!c.hydrate)return;const r=_(this.$.data),s=JSON.parse(((i=this.$el.dataset)==null?void 0:i.dehydrated)||"{}"),n=JSON.parse(((o=this.$el.dataset)==null?void 0:o.stale)||"{}");for(const u of Object.keys(n))r[u].value._query&&r[u].value._query.refresh();for(const[u,f]of Object.entries(h(h({},s),n)))r[u].value={loading:!1,data:f}},async serverPrefetch(){await y.inject().flushing}})}function ye(t,e){T(()=>{const r=e();for(const[s,n]of Object.entries(r))if(typeof n=="object")for(const[i,o]of Object.entries(n))t[s][i]=o;else t[s]=n})}function me(t){return E(t.$).proxy}function E(t){return!t.parent||t.parent.type===re?t:E(t.parent)}function k(t,e){if(t instanceof l){const r=H(t,e);return se(()=>{const s=r.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return V(t,e)[0]}function V(t,e){if(t instanceof l)return H(t,e);const r=t;r.instanceCount||(r.instanceCount=j(0)),r.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return R(s,n,r,e),s}function R(t,e,r,s){if(!!e){if(e.component)e.type===r&&ve(e.component.proxy,s)&&t.push(e.component.proxy),R(t,e.component.subTree,r,s);else if(Array.isArray(e.children))for(const n of e.children)O(n)&&R(t,n,r,s)}}function ve(t,e){if(!e)return!0;for(const[r,s]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==s)return!1}else if(t[r]!==s)return!1;return!0}function A(t,e,...r){const s=t.$;B(!0,e,r,s)}function M(t,e,r){if(r.component)B(!1,t,e,r.component);else if(Array.isArray(r.children))for(const s of r.children)O(s)&&M(t,e,s)}function B(t,e,r,s){const n=s.proxy;!t&&n[e]?n[e].apply(n,r):M(e,r,s.subTree)}function D(){return new Promise(t=>{ne(t)})}async function C(t){return new Promise(e=>setTimeout(e,t))}function be(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function J(t){let e=this&&this.Resource!==l?this:void 0;return{as(r){const s=n=>{const i=[];for(const f of t.affectedTables){const b=$.get(f);for(const d of b||[])i.push(d.newRequest())}const o=t.command||r,u=new Q(o,n);return c.rpcProvider(i,u),u.promise};return L(h({},e),{[r]:s,defineCommand:J})}}}function ge(t,e){return m(new l(t,e))}const p=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(p.key,new p)}static inject(){return N().appContext.provides[p.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await D();const e=this.buffered;this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}};let y=p;a(y,"key",Symbol());class we{constructor(e,r){a(this,"result",j({loading:!1,data:[],error:void 0,_query:this}));a(this,"criteria",{});a(this,"version",0);a(this,"queryBuffer");this.resource=e,this.queryBuffer=y.inject();const s=N();T(()=>{r&&(this.criteria=r()),c.hydrate&&!s.isMounted||this.queryBuffer.execute(this.newRequest(!s.isMounted))})}newRequest(e){return this.version++,new K(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class l{constructor(e,r){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=h({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,m(r)}load(e,r,s,n){const i=this.clone();return i.subResources[e]={single:!0,resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},m(i)}query(e,r,s,n){const i=this.clone();return i.subResources[e]={resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},m(i)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function H(t,e){const r=new we(_(t),e);return N().scope.run(()=>{let s=$.get(t.table);s||$.set(t.table,s=new Set),s.add(r),ie(()=>{s.delete(r)})}),r.result}class K{constructor(e,r){a(this,"baseVersion");a(this,"criteria");a(this,"showingLoading");this.query=e,this.showLoading=r,this.baseVersion=e.version,this.criteria=e.criteria,r&&!c.dehydrate&&(c.loadingPreDelay?C(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await C(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,r){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,r)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:r}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class Q{constructor(e,r){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((s,n)=>{this.resolve=i=>{this.responded||(this.responded=!0,s(i))},this.reject=i=>{this.responded||(this.responded=!0,n(i))}})}toJSON(){return{command:this.command,args:this.args}}}var _e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:pe,animate:ye,pageOf:me,load:k,query:V,walk:A,waitNextTick:D,sleep:C,castTo:be,defineCommand:J,defineResource:ge,Resource:l,QueryRequest:K,CommandRequest:Q});var U=(t,e)=>{const r=t.__vccOpts||t;for(const[s,n]of e)r[s]=n;return r};let qe=1;const $e=S({props:{name:{required:!0,type:String},label:{default:""},type:{default:"text"}},data(){return{inputId:`input${qe++}`,value:""}},methods:{fillForm(t){t[this.name]=this.value}}}),ke={class:"row"},Re=["for"],Ce=["id","type","name"];function Oe(t,e,r,s,n,i){return F(),I("div",ke,[v("label",{for:t.inputId},q(t.label),9,Re),oe(v("input",{id:t.inputId,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value=o),type:t.type,name:t.name},null,8,Ce),[[ae,t.value]])])}var w=U($e,[["render",Oe],["__scopeId","data-v-20bc85b6"]]);const je=S({components:{InputField:w},computed:{username(){var t;return(t=k(w,{$parent:this,name:"username"}))==null?void 0:t.value},hobby(){var t;return(t=k(w,{$parent:this,name:"hobby"}))==null?void 0:t.value}},methods:{onSubmit(){const t={};A(this,"fillForm",t),console.log("!!! submit",t)}}});function Ne(t,e,r,s,n,i){const o=ue("InputField");return F(),I("form",null,[v("fieldset",null,[P(o,{label:"User Name:",name:"username"}),P(o,{label:"Hobby:",name:"hobby"}),v("button",{type:"submit",onClick:e[0]||(e[0]=ce((...u)=>t.onSubmit&&t.onSubmit(...u),["prevent"]))},"submit"),le(" hello "+q(t.username||"[username]")+", who likes "+q(t.hobby||"[hobby]"),1)])])}var Se=U(je,[["render",Ne],["__scopeId","data-v-554f00a0"]]);const Fe=S({setup(t){return(e,r)=>(F(),de(Se))}}),z=fe(Fe);z.use(_e);z.mount("#app");
