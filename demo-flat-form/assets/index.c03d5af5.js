var H=Object.defineProperty,G=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var b=(t,e,r)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,v=(t,e)=>{for(var r in e||(e={}))X.call(e,r)&&b(t,r,e[r]);if(F)for(var r of F(e))Y.call(e,r)&&b(t,r,e[r]);return t},N=(t,e)=>G(t,W(e));var a=(t,e,r)=>(b(t,typeof e!="symbol"?e+"":e,r),r);import{i as R,h as Z,t as w,a as ee,r as C,g as O,e as x,K as te,c as re,n as se,b as h,o as ne,d as S,f as I,j as m,k as g,w as oe,v as ie,l as j,m as ae,p as T,q as ue,s as ce,u as le,x as de}from"./vendor.3e4ef62c.js";const fe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};fe();const u={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},$=new Map;function pe(t,e){p.provide(t),Object.assign(u,e),t.mixin({created(){if(u.dehydrate||u.hydrate){const s=this.$.render;this.$.render=function(...o){let i=s.apply(this,o);if((!R(i)||typeof i.type!="string")&&(i=Z("div",i)),u.hydrate)return i;i.props||(i.props={});const l={};for(const[y,d]of Object.entries(w(this.$.data)))ee(d)&&d.value&&d.value.data&&(l[y]=d.value.data);return i.props["data-dehydrated"]=JSON.stringify(l),i}}const r=this.$.type;let n=r.instanceCount;n||(n=r.instanceCount=C(0)),n.value++},beforeMount(){var s;if(!u.hydrate)return;const r=(s=this.$el.dataset)==null?void 0:s.dehydrated;if(!r)return;const n=w(this.$.data);for(const[o,i]of Object.entries(JSON.parse(r)))n[o].value={loading:!1,data:i}},async serverPrefetch(){await p.inject().flushing}})}function he(t,e){x(()=>{const r=e();for(const[n,s]of Object.entries(r))if(typeof s=="object")for(const[o,i]of Object.entries(s))t[n][o]=i;else t[n]=s})}function me(t){return P(t.$).proxy}function P(t){return!t.parent||t.parent.type===te?t:P(t.parent)}function k(t,e){if(t instanceof c){const r=B(t,e);return re(()=>{const n=r.value;return{loading:n.loading,data:n.data[0],error:n.error}})}return V(t,e)[0]}function V(t,e){if(t instanceof c)return B(t,e);const r=t;r.instanceCount||(r.instanceCount=C(0)),r.instanceCount.value;const n=[];let s;if(e.$parent)s=e.$parent.$.subTree;else if(e.$root)s=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return q(n,s,r,e),n}function q(t,e,r,n){if(!!e){if(e.component)e.type===r&&ye(e.component.proxy,n)&&t.push(e.component.proxy),q(t,e.component.subTree,r,n);else if(Array.isArray(e.children))for(const s of e.children)R(s)&&q(t,s,r,n)}}function ye(t,e){if(!e)return!0;for(const[r,n]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==n)return!1}else if(t[r]!==n)return!1;return!0}function A(t,e,...r){const n=t.$;M(!0,e,r,n)}function E(t,e,r){if(r.component)M(!1,t,e,r.component);else if(Array.isArray(r.children))for(const n of r.children)R(n)&&E(t,e,n)}function M(t,e,r,n){const s=n.proxy;!t&&s[e]?s[e].apply(s,r):E(e,r,n.subTree)}function J(){return new Promise(t=>{se(t)})}async function be(t){return new Promise(e=>setTimeout(e,t))}function ve(t,e){if(e instanceof c)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function L(t){let e=this&&this.Resource!==c?this:void 0;return{as(r){const n=s=>{const o=[];for(const y of t.affectedTables){const d=$.get(y);for(const z of d||[])o.push(z.newRequest())}const i=t.command||r,l=new K(i,s);return u.rpcProvider(o,l),l.promise};return N(v({},e),{[r]:n,defineCommand:L})}}}function _e(t,e){return h(new c(t,e))}const f=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(f.key,new f)}static inject(){return O().appContext.provides[f.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await J();const e=this.buffered.map(r=>r.newRequest());this.buffered=[],await u.rpcProvider(e),this.flushing=void 0}};let p=f;a(p,"key",Symbol());class we{constructor(e,r){a(this,"result",C({loading:!1,data:[],error:void 0}));a(this,"criteria",{});a(this,"version",0);this.resource=e;const n=p.inject(),s=O();x(()=>{r&&(this.criteria=r()),u.hydrate&&!s.isMounted||n.execute(this)})}newRequest(){return this.version++,new D(this)}}class c{constructor(e,r){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new c(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=v({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,h(r)}load(e,r,n,s){const o=this.clone();return o.subResources[e]={single:!0,resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},h(o)}query(e,r,n,s){const o=this.clone();return o.subResources[e]={resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},h(o)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function B(t,e){const r=new we(w(t),e);return O().scope.run(()=>{let n=$.get(t.table);n||$.set(t.table,n=new Set),n.add(r),ne(()=>{n.delete(r)})}),r.result}class D{constructor(e){a(this,"baseVersion");a(this,"criteria");this.query=e,this.baseVersion=e.version,this.criteria=e.criteria}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0})}reject(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:[],error:e})}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class K{constructor(e,r){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((n,s)=>{this.resolve=o=>{this.responded||(this.responded=!0,n(o))},this.reject=o=>{this.responded||(this.responded=!0,s(o))}})}toJSON(){return{command:this.command,args:this.args}}}var ge=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:pe,animate:he,pageOf:me,load:k,query:V,walk:A,waitNextTick:J,sleep:be,castTo:ve,defineCommand:L,defineResource:_e,Resource:c,QueryRequest:D,CommandRequest:K});var Q=(t,e)=>{const r=t.__vccOpts||t;for(const[n,s]of e)r[n]=s;return r};let $e=1;const ke=S({props:{name:{required:!0,type:String},label:{default:""},type:{default:"text"}},data(){return{inputId:`input${$e++}`,value:""}},methods:{fillForm(t){t[this.name]=this.value}}}),qe={class:"row"},Re=["for"],Ce=["id","type","name"];function Oe(t,e,r,n,s,o){return j(),I("div",qe,[m("label",{for:t.inputId},g(t.label),9,Re),oe(m("input",{id:t.inputId,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value=i),type:t.type,name:t.name},null,8,Ce),[[ie,t.value]])])}var _=Q(ke,[["render",Oe],["__scopeId","data-v-20bc85b6"]]);const Se=S({components:{InputField:_},computed:{username(){var t;return(t=k(_,{$parent:this,name:"username"}))==null?void 0:t.value},hobby(){var t;return(t=k(_,{$parent:this,name:"hobby"}))==null?void 0:t.value}},methods:{onSubmit(){const t={};A(this,"fillForm",t),console.log("!!! submit",t)}}});function je(t,e,r,n,s,o){const i=ae("InputField");return j(),I("form",null,[m("fieldset",null,[T(i,{label:"User Name:",name:"username"}),T(i,{label:"Hobby:",name:"hobby"}),m("button",{type:"submit",onClick:e[0]||(e[0]=ue((...l)=>t.onSubmit&&t.onSubmit(...l),["prevent"]))},"submit"),ce(" hello "+g(t.username||"[username]")+", who likes "+g(t.hobby||"[hobby]"),1)])])}var Fe=Q(Se,[["render",je],["__scopeId","data-v-554f00a0"]]);const Ne=S({setup(t){return(e,r)=>(j(),le(Fe))}}),U=de(Ne);U.use(ge);U.mount("#app");
