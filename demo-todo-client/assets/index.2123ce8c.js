var ee=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var _=(t,e,s)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,y=(t,e)=>{for(var s in e||(e={}))oe.call(e,s)&&_(t,s,e[s]);if(A)for(var s of A(e))re.call(e,s)&&_(t,s,e[s]);return t},D=(t,e)=>te(t,se(e));var a=(t,e,s)=>(_(t,typeof e!="symbol"?e+"":e,s),s);import{r as g,i as P,h as ne,t as O,a as ie,b as S,g as x,e as M,K as ae,c as ue,n as ce,o as de,d as k,f as h,w as I,v as le,j as w,k as E,l as b,m as d,p as fe,q as he,F as $,s as pe,u as B,x as ye,y as me,z as F,A as ve}from"./vendor.a1cd7a93.js";const ge=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}};ge();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},j=new Map;function be(t,e){v.provide(t),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const r=this.$.render;this.$.render=function(...n){let i=r.apply(this,n);if((!P(i)||typeof i.type!="string")&&(i=ne("div",i)),c.hydrate)return i;i.props||(i.props={});const u={},p={};for(const[T,f]of Object.entries(O(this.$.data)))ie(f)&&f.value&&f.value.data&&((f.value.stale?p:u)[T]=f.value.data);return i.props["data-dehydrated"]=JSON.stringify(u),i.props["data-stale"]=JSON.stringify(p),i}}const s=this.$.type;let o=s.instanceCount;o||(o=s.instanceCount=S(0)),o.value++},beforeMount(){var n,i;if(!c.hydrate)return;const s=O(this.$.data),o=JSON.parse(((n=this.$el.dataset)==null?void 0:n.dehydrated)||"{}"),r=JSON.parse(((i=this.$el.dataset)==null?void 0:i.stale)||"{}");for(const u of Object.keys(r))s[u].value._query&&s[u].value._query.refresh();for(const[u,p]of Object.entries(y(y({},o),r)))s[u].value={loading:!1,data:p}},async serverPrefetch(){await v.inject().flushing}})}function we(t,e){M(()=>{const s=e();for(const[o,r]of Object.entries(s))if(typeof r=="object")for(const[n,i]of Object.entries(r))t[o][n]=i;else t[o]=r})}function $e(t){return K(t.$).proxy}function K(t){return!t.parent||t.parent.type===ae?t:K(t.parent)}function qe(t,e){if(t instanceof l){const s=G(t,e);return ue(()=>{const o=s.value;return{loading:o.loading,data:o.data[0],error:o.error}})}return q(t,e)[0]}function q(t,e){if(t instanceof l)return G(t,e);const s=t;s.instanceCount||(s.instanceCount=S(0)),s.instanceCount.value;const o=[];let r;if(e.$parent)r=e.$parent.$.subTree;else if(e.$root)r=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return L(o,r,s,e),o}function L(t,e,s,o){if(!!e){if(e.component)e.type===s&&ke(e.component.proxy,o)&&t.push(e.component.proxy),L(t,e.component.subTree,s,o);else if(Array.isArray(e.children))for(const r of e.children)P(r)&&L(t,r,s,o)}}function ke(t,e){if(!e)return!0;for(const[s,o]of Object.entries(e))if(s==="$parent"){if(t.$.parent.proxy!==o)return!1}else if(t[s]!==o)return!1;return!0}function Re(t,e,...s){const o=t.$;z(!0,e,s,o)}function Q(t,e,s){if(s.component)z(!1,t,e,s.component);else if(Array.isArray(s.children))for(const o of s.children)P(o)&&Q(t,e,o)}function z(t,e,s,o){const r=o.proxy;!t&&r[e]?r[e].apply(r,s):Q(e,s,o.subTree)}function H(){return new Promise(t=>{ce(t)})}async function N(t){return new Promise(e=>setTimeout(e,t))}function U(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function R(t){let e=this&&this.Resource!==l?this:void 0;return{as(s){const o=r=>{const n=[];for(const p of t.affectedTables){const T=j.get(p);for(const f of T||[])n.push(f.newRequest())}const i=t.command||s,u=new Y(i,r);return c.rpcProvider(n,u),u.promise};return D(y({},e),{[s]:o,defineCommand:R})}}}function W(t,e){return g(new l(t,e))}const m=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(m.key,new m)}static inject(){return x().appContext.provides[m.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await H();const e=this.buffered;this.buffered=[],await c.rpcProvider(e);for(const s of e)await s.showingLoading;this.flushing=void 0}};let v=m;a(v,"key",Symbol());class Ce{constructor(e,s){a(this,"result",S({loading:!1,data:[],error:void 0,_query:this}));a(this,"criteria",{});a(this,"version",0);a(this,"queryBuffer");this.resource=e,this.queryBuffer=v.inject();const o=x();M(()=>{s&&(this.criteria=s()),c.hydrate&&!o.isMounted||this.queryBuffer.execute(this.newRequest(!o.isMounted))})}newRequest(e){return this.version++,new X(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class l{constructor(e,s){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=s}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=y({},this.subResources),e}pick(...e){const s=this.clone();return s.pickedFields=e,g(s)}load(e,s,o,r){const n=this.clone();return n.subResources[e]={single:!0,resource:s,dynamicCriteria:o,staticCriteria:r==null?void 0:r.staticCriteria},g(n)}query(e,s,o,r){const n=this.clone();return n.subResources[e]={resource:s,dynamicCriteria:o,staticCriteria:r==null?void 0:r.staticCriteria},g(n)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function G(t,e){const s=new Ce(O(t),e);return x().scope.run(()=>{let o=j.get(t.table);o||j.set(t.table,o=new Set),o.add(s),de(()=>{o.delete(s)})}),s.result}class X{constructor(e,s){a(this,"baseVersion");a(this,"criteria");a(this,"showingLoading");this.query=e,this.showLoading=s,this.baseVersion=e.version,this.criteria=e.criteria,s&&(c.loadingPreDelay?N(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await N(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,s){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,s)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:s}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class Y{constructor(e,s){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=s,this.promise=new Promise((o,r)=>{this.resolve=n=>{this.responded||(this.responded=!0,o(n))},this.reject=n=>{this.responded||(this.responded=!0,r(n))}})}toJSON(){return{command:this.command,args:this.args}}}var Te=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:be,animate:we,pageOf:$e,load:qe,query:q,walk:Re,waitNextTick:H,sleep:N,castTo:U,defineCommand:R,defineResource:W,Resource:l,QueryRequest:X,CommandRequest:Y}),V=(t,e)=>{const s=t.__vccOpts||t;for(const[o,r]of e)s[o]=r;return s};const C=W("todo"),_e=R({affectedTables:[C.table]}).as("removeTodo"),Oe=k({props:{todo:{default:U(void 0,C)}},data(){return{content:this.todo.content,completed:!1}},methods:{async onRemove(){await _e.removeTodo({id:this.todo.id})}}});function je(t,e,s,o,r,n){return d(),h("div",null,[I(w("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.completed=i)},null,512),[[le,t.completed]]),E(" "+b(t.content)+" ",1),w("button",{onClick:e[1]||(e[1]=(...i)=>t.onRemove&&t.onRemove(...i))},"x")])}var J=V(Oe,[["render",je]]);const Le=R({affectedTables:[C.table]}).as("saveTodo"),Ne=k({data(){return{content:""}},methods:{async onEnter(){!this.content||(await Le.saveTodo({content:this.content}),this.content="")}}}),Pe=E(" What needs to be done? ");function Se(t,e,s,o,r,n){return d(),h($,null,[Pe,I(w("input",{type:"textbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.content=i),onKeyup:e[1]||(e[1]=he((...i)=>t.onEnter&&t.onEnter(...i),["enter"]))},null,544),[[fe,t.content]])],64)}var xe=V(Ne,[["render",Se]]);const Ee=k({components:{TodoListItem:J},data(){return{todos:q(C)}},computed:{completedCount(){let t=0;for(const e of q(J,{$parent:this}))e.completed&&t++;return t}}}),Ve={key:0},Ae={key:1};function De(t,e,s,o,r,n){const i=pe("TodoListItem");return d(),h($,null,[E(b(t.completedCount)+" out of "+b(t.todos.data.length)+" items completed ",1),t.todos.loading?(d(),h("span",Ve,"loading...")):B("",!0),t.todos.error?(d(),h("span",Ae,b(t.todos.error),1)):B("",!0),(d(!0),h($,null,ye(t.todos.data,u=>(d(),me(i,{key:u.id,todo:u},null,8,["todo"]))),128))],64)}var Be=V(Ee,[["render",De]]);const Fe=w("h1",null,"To-Do List",-1),Je=k({setup(t){return(e,s)=>(d(),h($,null,[Fe,F(xe),F(Be)],64))}}),Z=ve(Je);Z.use(Te,{loadingPreDelay:200,loadingPostDelay:5e3,rpcProvider:async(t,e)=>{try{const o=await(await fetch("http://localhost:8080/",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({queries:t,command:e},void 0,"  ")})).json();e&&e.resolve(o.command);for(const[r,n]of o.queries.entries())t[r].resolve(n)}catch(s){e&&e.reject(s);for(const o of t)o.reject(s)}}});Z.mount("#app");
