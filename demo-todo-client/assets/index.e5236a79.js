var ee=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var _=(t,e,s)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,v=(t,e)=>{for(var s in e||(e={}))re.call(e,s)&&_(t,s,e[s]);if(B)for(var s of B(e))oe.call(e,s)&&_(t,s,e[s]);return t},V=(t,e)=>te(t,se(e));var u=(t,e,s)=>(_(t,typeof e!="symbol"?e+"":e,s),s);import{r as g,t as O,i as ne,a as P,h as ie,b as E,K as ae,c as ue,n as ce,g as J,e as de,o as le,d as k,f as m,w as M,v as fe,j as w,k as S,l as b,m as h,p as he,q as pe,F as $,s as ye,u as me,x as ve,y as ge,z as A,A as be}from"./vendor.f0a0d7c7.js";const we=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}};we();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},L=new Map;function $e(t,e){const s=new R;t.provide(R.key,s),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const n=this.$.render;this.$.render=function(...i){let a=n.apply(this,i);const d={},l={};for(const[f,y]of Object.entries(O(this.$.data)))ne(y)&&y.value&&y.value.data&&((y.value.stale?l:d)[f]=y.value.data);return Object.keys(l).length===0&&Object.keys(d).length===0||((!P(a)||typeof a.type!="string")&&(a=ie(c.wrapperComponent||"div",a)),c.hydrate)||(a.props||(a.props={}),a.props["data-dehydrated"]=JSON.stringify(d),a.props["data-stale"]=JSON.stringify(l)),a}}const r=this.$.type;let o=r.instanceCount;o||(o=r.instanceCount=E(0)),o.value++},beforeMount(){var i,a,d,l;if(!c.hydrate)return;const r=O(this.$.data),o=JSON.parse(((a=(i=this.$el)==null?void 0:i.dataset)==null?void 0:a.dehydrated)||"{}"),n=JSON.parse(((l=(d=this.$el)==null?void 0:d.dataset)==null?void 0:l.stale)||"{}");for(const f of Object.keys(n))r[f].value._query&&r[f].value._query.refresh();for(const[f,y]of Object.entries(v(v({},o),n)))r[f].value={loading:!1,data:y}},async serverPrefetch(){await s.flushing},unmounted(){this.$.type.instanceCount.value--}})}function qe(t){return I(t.$).proxy}function I(t){return!t.parent||t.parent.type===ae?t:I(t.parent)}function Re(t,e){if(t instanceof p){const s=W(t,e);return ue(()=>{const r=s.value;return{loading:r.loading,data:r.data[0],error:r.error}})}return q(t,e)[0]}function q(t,e){if(t instanceof p)return W(t,e);const s=t;s.instanceCount||(s.instanceCount=E(0)),s.instanceCount.value;const r=[];let o;if(e.$parent)o=e.$parent.$.subTree;else if(e.$root)o=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return N(r,o,s,e),r}function N(t,e,s,r){if(!!e){if(e.component)e.type===s&&ke(e.component.proxy,r)&&t.push(e.component.proxy),N(t,e.component.subTree,s,r);else if(Array.isArray(e.children))for(const o of e.children)P(o)&&N(t,o,s,r)}}function ke(t,e){if(!e)return!0;for(const[s,r]of Object.entries(e))if(s==="$parent"){if(t.$.parent.proxy!==r)return!1}else if(t[s]!==r)return!1;return!0}function Ce(t,e,...s){const r=t.$;Q(!0,e,s,r)}function K(t,e,s){if(s.component)Q(!1,t,e,s.component);else if(Array.isArray(s.children))for(const r of s.children)P(r)&&K(t,e,r)}function Q(t,e,s,r){const o=r.proxy;!t&&o[e]?o[e].apply(o,s):K(e,s,r.subTree)}function z(){return new Promise(t=>ce(t))}async function j(t){return new Promise(e=>setTimeout(e,t))}function H(t,e){if(e instanceof p)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function U(t,e){return g(new p(t,e))}class p{constructor(e,s){u(this,"pickedFields");u(this,"subResources",{});this.table=e,this.options=s}clone(){const e=new p(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=v({},this.subResources),e}pick(...e){const s=this.clone();return s.pickedFields=e,g(s)}load(e,s,r,o){const n=this.clone();return n.subResources[e]={single:!0,resource:s,dynamicCriteria:r,staticCriteria:o==null?void 0:o.staticCriteria},g(n)}query(e,s,r,o){const n=this.clone();return n.subResources[e]={resource:s,dynamicCriteria:r,staticCriteria:o==null?void 0:o.staticCriteria},g(n)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function W(t,e){const s=new Te(O(t),e);return J().scope.run(()=>{const r=G(t);r.forEach(o=>D(o).add(s)),le(()=>{r.forEach(o=>D(o).delete(s))})}),s.result}function D(t){let e=L.get(t);return e||L.set(t,e=new Set),e}function G(t){var s;let e=((s=t.options)==null?void 0:s.sourceTables)?[t.table,...t.options.sourceTables]:[t.table];for(const r of Object.values(t.subResources))e=[...e,...G(r.resource)];return e}class R{constructor(){u(this,"buffered",[]);u(this,"flushing")}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await z();const e=this.buffered;this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}}u(R,"key",Symbol());class Te{constructor(e,s){u(this,"result",E({loading:!1,data:[],error:void 0,_query:this}));u(this,"criteria",{});u(this,"version",0);u(this,"queryBuffer");this.resource=e;const r=J();if(this.queryBuffer=r.appContext.provides[R.key],!this.queryBuffer)throw new Error("please add app.use(vdb) to install vue-db before query");de(()=>{s&&(this.criteria=s()),c.hydrate&&!r.isMounted||this.queryBuffer.execute(this.newRequest(!r.isMounted))})}newRequest(e){return this.version++,new X(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class X{constructor(e,s){u(this,"baseVersion");u(this,"criteria");u(this,"showingLoading");this.query=e,this.showLoading=s,this.baseVersion=e.version,this.criteria=e.criteria,s&&!c.dehydrate&&(c.loadingPreDelay?j(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await j(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,s){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,s)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:s}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}function C(t){let e=this&&this.Resource!==p?this:void 0;return{as(s){const r=o=>{const n=[];for(const d of t.affectedTables){const l=L.get(d);for(const f of l||[])n.push(f.newRequest())}const i=t.command||s,a=new Y(i,o);return c.rpcProvider(n,a),a.promise};return V(v({},e),{[s]:r,defineCommand:C})}}}class Y{constructor(e,s){u(this,"promise");u(this,"resolve");u(this,"reject");u(this,"responded",!1);this.command=e,this.args=s,this.promise=new Promise((r,o)=>{this.resolve=n=>{this.responded||(this.responded=!0,r(n))},this.reject=n=>{this.responded||(this.responded=!0,o(n))}})}toJSON(){return{command:this.command,args:this.args}}}var _e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:$e,pageOf:qe,load:Re,query:q,walk:Ce,waitNextTick:z,sleep:j,castTo:H,defineResource:U,Resource:p,QueryRequest:X,defineCommand:C,CommandRequest:Y}),x=(t,e)=>{const s=t.__vccOpts||t;for(const[r,o]of e)s[r]=o;return s};const T=U("todo"),Oe=C({affectedTables:[T.table]}).as("removeTodo"),Le=k({props:{todo:{default:H(void 0,T)}},data(){return{content:this.todo.content,completed:!1}},methods:{async onRemove(){await Oe.removeTodo({id:this.todo.id})}}});function Ne(t,e,s,r,o,n){return h(),m("div",null,[M(w("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.completed=i)},null,512),[[fe,t.completed]]),S(" "+b(t.content)+" ",1),w("button",{onClick:e[1]||(e[1]=(...i)=>t.onRemove&&t.onRemove(...i))},"x")])}var F=x(Le,[["render",Ne]]);const je=C({affectedTables:[T.table]}).as("saveTodo"),Pe=k({data(){return{content:""}},methods:{async onEnter(){!this.content||(await je.saveTodo({content:this.content}),this.content="")}}}),Ee=S(" What needs to be done? ");function Se(t,e,s,r,o,n){return h(),m($,null,[Ee,M(w("input",{type:"textbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.content=i),onKeyup:e[1]||(e[1]=pe((...i)=>t.onEnter&&t.onEnter(...i),["enter"]))},null,544),[[he,t.content]])],64)}var xe=x(Pe,[["render",Se]]);const Be=k({components:{TodoListItem:F},data(){return{todos:q(T)}},computed:{completedCount(){let t=0;for(const e of q(F,{$parent:this}))e.completed&&t++;return t}}}),Ve={key:0},Ae={key:1};function De(t,e,s,r,o,n){const i=ye("TodoListItem");return h(),m($,null,[S(b(t.completedCount)+" out of "+b(t.todos.data.length)+" items completed ",1),t.todos.loading?(h(),m("span",Ve,"loading...")):me("",!0),t.todos.error?(h(),m("span",Ae,b(t.todos.error),1)):(h(!0),m($,{key:2},ve(t.todos.data,a=>(h(),ge(i,{key:a.id,todo:a},null,8,["todo"]))),128))],64)}var Fe=x(Be,[["render",De]]);const Je=w("h1",null,"To-Do List",-1),Me=k({setup(t){return(e,s)=>(h(),m($,null,[Je,A(xe),A(Fe)],64))}}),Z=be(Me);Z.use(_e,{loadingPreDelay:200,loadingPostDelay:1e3,rpcProvider:async(t,e)=>{try{const r=await(await fetch("http://localhost:8080/",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({queries:t,command:e},void 0,"  ")})).json();e&&e.resolve(r.command);for(const[o,n]of r.queries.entries())t[o].resolve(n)}catch(s){e&&e.reject(s);for(const r of t)r.reject(s)}}});Z.mount("#app");
