var ee=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var C=(t,e,o)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,T=(t,e)=>{for(var o in e||(e={}))se.call(e,o)&&C(t,o,e[o]);if(V)for(var o of V(e))re.call(e,o)&&C(t,o,e[o]);return t},A=(t,e)=>te(t,oe(e));var a=(t,e,o)=>(C(t,typeof e!="symbol"?e+"":e,o),o);import{r as m,i as N,h as ne,t as _,a as ie,b as P,g as S,e as J,K as ae,c as ue,n as ce,o as de,d as $,f,w as B,v as le,j as g,k as x,l as v,m as d,p as fe,q as pe,F as b,s as he,u as D,x as ye,y as me,z as F,A as ve}from"./vendor.a1cd7a93.js";const ge=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}};ge();const u={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},O=new Map;function be(t,e){y.provide(t),Object.assign(u,e),t.mixin({created(){if(u.dehydrate||u.hydrate){const r=this.$.render;this.$.render=function(...n){let i=r.apply(this,n);if((!N(i)||typeof i.type!="string")&&(i=ne("div",i)),u.hydrate)return i;i.props||(i.props={});const c={};for(const[q,p]of Object.entries(_(this.$.data)))ie(p)&&p.value&&p.value.data&&(c[q]=p.value.data);return i.props["data-dehydrated"]=JSON.stringify(c),i}}const o=this.$.type;let s=o.instanceCount;s||(s=o.instanceCount=P(0)),s.value++},beforeMount(){var r;if(!u.hydrate)return;const o=(r=this.$el.dataset)==null?void 0:r.dehydrated;if(!o)return;const s=_(this.$.data);for(const[n,i]of Object.entries(JSON.parse(o)))s[n].value={loading:!1,data:i}},async serverPrefetch(){await y.inject().flushing}})}function we(t,e){J(()=>{const o=e();for(const[s,r]of Object.entries(o))if(typeof r=="object")for(const[n,i]of Object.entries(r))t[s][n]=i;else t[s]=r})}function $e(t){return I(t.$).proxy}function I(t){return!t.parent||t.parent.type===ae?t:I(t.parent)}function ke(t,e){if(t instanceof l){const o=G(t,e);return ue(()=>{const s=o.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return w(t,e)[0]}function w(t,e){if(t instanceof l)return G(t,e);const o=t;o.instanceCount||(o.instanceCount=P(0)),o.instanceCount.value;const s=[];let r;if(e.$parent)r=e.$parent.$.subTree;else if(e.$root)r=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return j(s,r,o,e),s}function j(t,e,o,s){if(!!e){if(e.component)e.type===o&&Re(e.component.proxy,s)&&t.push(e.component.proxy),j(t,e.component.subTree,o,s);else if(Array.isArray(e.children))for(const r of e.children)N(r)&&j(t,r,o,s)}}function Re(t,e){if(!e)return!0;for(const[o,s]of Object.entries(e))if(o==="$parent"){if(t.$.parent.proxy!==s)return!1}else if(t[o]!==s)return!1;return!0}function qe(t,e,...o){const s=t.$;Q(!0,e,o,s)}function K(t,e,o){if(o.component)Q(!1,t,e,o.component);else if(Array.isArray(o.children))for(const s of o.children)N(s)&&K(t,e,s)}function Q(t,e,o,s){const r=s.proxy;!t&&r[e]?r[e].apply(r,o):K(e,o,s.subTree)}function z(){return new Promise(t=>{ce(t)})}async function L(t){return new Promise(e=>setTimeout(e,t))}function U(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function k(t){let e=this&&this.Resource!==l?this:void 0;return{as(o){const s=r=>{const n=[];for(const q of t.affectedTables){const p=O.get(q);for(const Z of p||[])n.push(Z.newRequest())}const i=t.command||o,c=new X(i,r);return u.rpcProvider(n,c),c.promise};return A(T({},e),{[o]:s,defineCommand:k})}}}function W(t,e){return m(new l(t,e))}const h=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(h.key,new h)}static inject(){return S().appContext.provides[h.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await z();const e=this.buffered;this.buffered=[],await u.rpcProvider(e),this.flushing=void 0}};let y=h;a(y,"key",Symbol());class Ce{constructor(e,o){a(this,"result",P({loading:!1,data:[],error:void 0}));a(this,"criteria",{});a(this,"version",0);this.resource=e;const s=y.inject(),r=S();J(()=>{o&&(this.criteria=o()),u.hydrate&&!r.isMounted||s.execute(this.newRequest(!r.isMounted))})}newRequest(e){return this.version++,new H(this,!!e)}}class l{constructor(e,o){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=o}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=T({},this.subResources),e}pick(...e){const o=this.clone();return o.pickedFields=e,m(o)}load(e,o,s,r){const n=this.clone();return n.subResources[e]={single:!0,resource:o,dynamicCriteria:s,staticCriteria:r==null?void 0:r.staticCriteria},m(n)}query(e,o,s,r){const n=this.clone();return n.subResources[e]={resource:o,dynamicCriteria:s,staticCriteria:r==null?void 0:r.staticCriteria},m(n)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function G(t,e){const o=new Ce(_(t),e);return S().scope.run(()=>{let s=O.get(t.table);s||O.set(t.table,s=new Set),s.add(o),de(()=>{s.delete(o)})}),o.result}class H{constructor(e,o){a(this,"baseVersion");a(this,"criteria");a(this,"showingLoading");this.query=e,this.showLoading=o,this.baseVersion=e.version,this.criteria=e.criteria,o&&(u.loadingPreDelay?L(u.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await L(u.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class X{constructor(e,o){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=o,this.promise=new Promise((s,r)=>{this.resolve=n=>{this.responded||(this.responded=!0,s(n))},this.reject=n=>{this.responded||(this.responded=!0,r(n))}})}toJSON(){return{command:this.command,args:this.args}}}var Te=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:be,animate:we,pageOf:$e,load:ke,query:w,walk:qe,waitNextTick:z,sleep:L,castTo:U,defineCommand:k,defineResource:W,Resource:l,QueryRequest:H,CommandRequest:X}),E=(t,e)=>{const o=t.__vccOpts||t;for(const[s,r]of e)o[s]=r;return o};const R=W("todo"),_e=k({affectedTables:[R.table]}).as("removeTodo"),Oe=$({props:{todo:{default:U(void 0,R)}},data(){return{content:this.todo.content,completed:!1}},methods:{async onRemove(){await _e.removeTodo({id:this.todo.id})}}});function je(t,e,o,s,r,n){return d(),f("div",null,[B(g("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.completed=i)},null,512),[[le,t.completed]]),x(" "+v(t.content)+" ",1),g("button",{onClick:e[1]||(e[1]=(...i)=>t.onRemove&&t.onRemove(...i))},"x")])}var M=E(Oe,[["render",je]]);const Le=k({affectedTables:[R.table]}).as("saveTodo"),Ne=$({data(){return{content:""}},methods:{async onEnter(){!this.content||(await Le.saveTodo({content:this.content}),this.content="")}}}),Pe=x(" What needs to be done? ");function Se(t,e,o,s,r,n){return d(),f(b,null,[Pe,B(g("input",{type:"textbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.content=i),onKeyup:e[1]||(e[1]=pe((...i)=>t.onEnter&&t.onEnter(...i),["enter"]))},null,544),[[fe,t.content]])],64)}var xe=E(Ne,[["render",Se]]);const Ee=$({components:{TodoListItem:M},data(){return{todos:w(R)}},computed:{completedCount(){let t=0;for(const e of w(M,{$parent:this}))e.completed&&t++;return t}}}),Ve={key:0},Ae={key:1};function De(t,e,o,s,r,n){const i=he("TodoListItem");return d(),f(b,null,[x(v(t.completedCount)+" out of "+v(t.todos.data.length)+" items completed ",1),t.todos.loading?(d(),f("span",Ve,"loading...")):D("",!0),t.todos.error?(d(),f("span",Ae,v(t.todos.error),1)):D("",!0),(d(!0),f(b,null,ye(t.todos.data,c=>(d(),me(i,{key:c.id,todo:c},null,8,["todo"]))),128))],64)}var Fe=E(Ee,[["render",De]]);const Me=g("h1",null,"To-Do List",-1),Je=$({setup(t){return(e,o)=>(d(),f(b,null,[Me,F(xe),F(Fe)],64))}}),Y=ve(Je);Y.use(Te,{loadingPreDelay:200,loadingPostDelay:5e3,rpcProvider:async(t,e)=>{try{const s=await(await fetch("http://localhost:8080/",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({queries:t,command:e},void 0,"  ")})).json();e&&e.resolve(s.command);for(const[r,n]of s.queries.entries())t[r].resolve(n)}catch(o){e&&e.reject(o);for(const s of t)s.reject(o)}}});Y.mount("#app");
