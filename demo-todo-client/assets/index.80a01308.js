var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var T=(t,e,r)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,C=(t,e)=>{for(var r in e||(e={}))re.call(e,r)&&T(t,r,e[r]);if(L)for(var r of L(e))oe.call(e,r)&&T(t,r,e[r]);return t},V=(t,e)=>ee(t,te(e));var a=(t,e,r)=>(T(t,typeof e!="symbol"?e+"":e,r),r);import{r as y,i as N,h as se,t as _,a as ne,b as S,g as x,e as J,K as ie,c as ae,n as ue,o as ce,d as $,f,w as B,v as de,j as b,k as P,l as v,m as c,p as le,q as fe,F as w,s as pe,u as A,x as he,y as me,z as F,A as ye}from"./vendor.a1cd7a93.js";const ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};ve();const d={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},O=new Map;function be(t,e){m.provide(t),Object.assign(d,e),t.mixin({created(){if(d.dehydrate||d.hydrate){const s=this.$.render;this.$.render=function(...n){let i=s.apply(this,n);if((!N(i)||typeof i.type!="string")&&(i=se("div",i)),d.hydrate)return i;i.props||(i.props={});const u={};for(const[q,p]of Object.entries(_(this.$.data)))ne(p)&&p.value&&p.value.data&&(u[q]=p.value.data);return i.props["data-dehydrated"]=JSON.stringify(u),i}}const r=this.$.type;let o=r.instanceCount;o||(o=r.instanceCount=S(0)),o.value++},beforeMount(){var s;if(!d.hydrate)return;const r=(s=this.$el.dataset)==null?void 0:s.dehydrated;if(!r)return;const o=_(this.$.data);for(const[n,i]of Object.entries(JSON.parse(r)))o[n].value={loading:!1,data:i}},async serverPrefetch(){await m.inject().flushing}})}function we(t,e){J(()=>{const r=e();for(const[o,s]of Object.entries(r))if(typeof s=="object")for(const[n,i]of Object.entries(s))t[o][n]=i;else t[o]=s})}function ge(t){return I(t.$).proxy}function I(t){return!t.parent||t.parent.type===ie?t:I(t.parent)}function $e(t,e){if(t instanceof l){const r=W(t,e);return ae(()=>{const o=r.value;return{loading:o.loading,data:o.data[0],error:o.error}})}return g(t,e)[0]}function g(t,e){if(t instanceof l)return W(t,e);const r=t;r.instanceCount||(r.instanceCount=S(0)),r.instanceCount.value;const o=[];let s;if(e.$parent)s=e.$parent.$.subTree;else if(e.$root)s=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return j(o,s,r,e),o}function j(t,e,r,o){if(!!e){if(e.component)e.type===r&&ke(e.component.proxy,o)&&t.push(e.component.proxy),j(t,e.component.subTree,r,o);else if(Array.isArray(e.children))for(const s of e.children)N(s)&&j(t,s,r,o)}}function ke(t,e){if(!e)return!0;for(const[r,o]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==o)return!1}else if(t[r]!==o)return!1;return!0}function Re(t,e,...r){const o=t.$;D(!0,e,r,o)}function K(t,e,r){if(r.component)D(!1,t,e,r.component);else if(Array.isArray(r.children))for(const o of r.children)N(o)&&K(t,e,o)}function D(t,e,r,o){const s=o.proxy;!t&&s[e]?s[e].apply(s,r):K(e,r,o.subTree)}function Q(){return new Promise(t=>{ue(t)})}async function qe(t){return new Promise(e=>setTimeout(e,t))}function z(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function k(t){let e=this&&this.Resource!==l?this:void 0;return{as(r){const o=s=>{const n=[];for(const q of t.affectedTables){const p=O.get(q);for(const Y of p||[])n.push(Y.newRequest())}const i=t.command||r,u=new H(i,s);return d.rpcProvider(n,u),u.promise};return V(C({},e),{[r]:o,defineCommand:k})}}}function U(t,e){return y(new l(t,e))}const h=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(h.key,new h)}static inject(){return x().appContext.provides[h.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await Q();const e=this.buffered.map(r=>r.newRequest());this.buffered=[],await d.rpcProvider(e),this.flushing=void 0}};let m=h;a(m,"key",Symbol());class Te{constructor(e,r){a(this,"result",S({loading:!1,data:[],error:void 0}));a(this,"criteria",{});a(this,"version",0);this.resource=e;const o=m.inject(),s=x();J(()=>{r&&(this.criteria=r()),d.hydrate&&!s.isMounted||o.execute(this)})}newRequest(){return this.version++,new G(this)}}class l{constructor(e,r){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=C({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,y(r)}load(e,r,o,s){const n=this.clone();return n.subResources[e]={single:!0,resource:r,dynamicCriteria:o,staticCriteria:s==null?void 0:s.staticCriteria},y(n)}query(e,r,o,s){const n=this.clone();return n.subResources[e]={resource:r,dynamicCriteria:o,staticCriteria:s==null?void 0:s.staticCriteria},y(n)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function W(t,e){const r=new Te(_(t),e);return x().scope.run(()=>{let o=O.get(t.table);o||O.set(t.table,o=new Set),o.add(r),ce(()=>{o.delete(r)})}),r.result}class G{constructor(e){a(this,"baseVersion");a(this,"criteria");this.query=e,this.baseVersion=e.version,this.criteria=e.criteria}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0})}reject(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:[],error:e})}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class H{constructor(e,r){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((o,s)=>{this.resolve=n=>{this.responded||(this.responded=!0,o(n))},this.reject=n=>{this.responded||(this.responded=!0,s(n))}})}toJSON(){return{command:this.command,args:this.args}}}var Ce=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:be,animate:we,pageOf:ge,load:$e,query:g,walk:Re,waitNextTick:Q,sleep:qe,castTo:z,defineCommand:k,defineResource:U,Resource:l,QueryRequest:G,CommandRequest:H}),E=(t,e)=>{const r=t.__vccOpts||t;for(const[o,s]of e)r[o]=s;return r};const R=U("todo"),_e=k({affectedTables:[R.table]}).as("removeTodo"),Oe=$({props:{todo:{default:z(void 0,R)}},data(){return{content:this.todo.content,completed:!1}},methods:{async onRemove(){await _e.removeTodo({id:this.todo.id})}}});function je(t,e,r,o,s,n){return c(),f("div",null,[B(b("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.completed=i)},null,512),[[de,t.completed]]),P(" "+v(t.content)+" ",1),b("button",{onClick:e[1]||(e[1]=(...i)=>t.onRemove&&t.onRemove(...i))},"x")])}var M=E(Oe,[["render",je]]);const Ne=k({affectedTables:[R.table]}).as("saveTodo"),Se=$({data(){return{content:""}},methods:{async onEnter(){!this.content||(await Ne.saveTodo({content:this.content}),this.content="")}}}),xe=P(" What needs to be done? ");function Pe(t,e,r,o,s,n){return c(),f(w,null,[xe,B(b("input",{type:"textbox","onUpdate:modelValue":e[0]||(e[0]=i=>t.content=i),onKeyup:e[1]||(e[1]=fe((...i)=>t.onEnter&&t.onEnter(...i),["enter"]))},null,544),[[le,t.content]])],64)}var Ee=E(Se,[["render",Pe]]);const Le=$({components:{TodoListItem:M},data(){return{todos:g(R)}},computed:{completedCount(){let t=0;for(const e of g(M,{$parent:this}))e.completed&&t++;return t}}}),Ve={key:0},Ae={key:1};function Fe(t,e,r,o,s,n){const i=pe("TodoListItem");return c(),f(w,null,[P(v(t.completedCount)+" out of "+v(t.todos.data.length)+" items completed ",1),t.todos.loading?A("",!0):(c(),f("span",Ve,"loading...")),t.todos.error?(c(),f("span",Ae,v(t.todos.error),1)):A("",!0),(c(!0),f(w,null,he(t.todos.data,u=>(c(),me(i,{key:u.id,todo:u},null,8,["todo"]))),128))],64)}var Me=E(Le,[["render",Fe]]);const Je=b("h1",null,"To-Do List",-1),Be=$({setup(t){return(e,r)=>(c(),f(w,null,[Je,F(Ee),F(Me)],64))}}),X=ye(Be);X.use(Ce,{defaultCommandTimeout:1e3,defaultQueryTimeout:1e3,rpcProvider:async(t,e)=>{try{const o=await(await fetch("http://localhost:8080/",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({queries:t,command:e},void 0,"  ")})).json();e&&e.resolve(o.command);for(const[s,n]of o.queries.entries())t[s].resolve(n)}catch(r){e&&e.reject(r);for(const o of t)o.reject(r)}}});X.mount("#app");
