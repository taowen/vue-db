var Q=Object.defineProperty,z=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var g=(r,e,t)=>e in r?Q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,m=(r,e)=>{for(var t in e||(e={}))Z.call(e,t)&&g(r,t,e[t]);if(j)for(var t of j(e))U.call(e,t)&&g(r,t,e[t]);return r},L=(r,e)=>z(r,G(e));var a=(r,e,t)=>(g(r,typeof e!="symbol"?e+"":e,t),t);import{r as p,i as C,h as W,t as b,a as X,b as $,g as O,e as _,K as Y,c as ee,n as te,o as re,d as se,f as v,j as P,F as x,k as ne,l as w,m as ie,p as oe,q as T,s as ae}from"./vendor.2716932a.js";const ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};ue();const u={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},R=new Map;function ce(r,e){h.provide(r),Object.assign(u,e),r.mixin({created(){if(u.dehydrate||u.hydrate){const n=this.$.render;this.$.render=function(...i){let o=n.apply(this,i);if((!C(o)||typeof o.type!="string")&&(o=W("div",o)),u.hydrate)return o;o.props||(o.props={});const d={};for(const[y,l]of Object.entries(b(this.$.data)))X(l)&&l.value&&l.value.data&&(d[y]=l.value.data);return o.props["data-dehydrated"]=JSON.stringify(d),o}}const t=this.$.type;let s=t.instanceCount;s||(s=t.instanceCount=$(0)),s.value++},beforeMount(){var n;if(!u.hydrate)return;const t=(n=this.$el.dataset)==null?void 0:n.dehydrated;if(!t)return;const s=b(this.$.data);for(const[i,o]of Object.entries(JSON.parse(t)))s[i].value={loading:!1,data:o}},async serverPrefetch(){await h.inject().flushing}})}function le(r,e){_(()=>{const t=e();for(const[s,n]of Object.entries(t))if(typeof n=="object")for(const[i,o]of Object.entries(n))r[s][i]=o;else r[s]=n})}function de(r){return E(r.$).proxy}function E(r){return!r.parent||r.parent.type===Y?r:E(r.parent)}function fe(r,e){if(r instanceof c){const t=B(r,e);return ee(()=>{const s=t.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return S(r,e)[0]}function S(r,e){if(r instanceof c)return B(r,e);const t=r;t.instanceCount||(t.instanceCount=$(0)),t.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return k(s,n,t,e),s}function k(r,e,t,s){if(!!e){if(e.component)e.type===t&&he(e.component.proxy,s)&&r.push(e.component.proxy),k(r,e.component.subTree,t,s);else if(Array.isArray(e.children))for(const n of e.children)C(n)&&k(r,n,t,s)}}function he(r,e){if(!e)return!0;for(const[t,s]of Object.entries(e))if(t==="$parent"){if(r.$.parent.proxy!==s)return!1}else if(r[t]!==s)return!1;return!0}function pe(r,e,...t){const s=r.$;F(!0,e,t,s)}function M(r,e,t){if(t.component)F(!1,r,e,t.component);else if(Array.isArray(t.children))for(const s of t.children)C(s)&&M(r,e,s)}function F(r,e,t,s){const n=s.proxy;!r&&n[e]?n[e].apply(n,t):M(e,t,s.subTree)}function V(){return new Promise(r=>{te(r)})}async function q(r){return new Promise(e=>setTimeout(e,r))}function ye(r,e){if(e instanceof c)return r;if(r.$.type!==e)throw new Error("type mismatch");return r}function D(r){let e=this&&this.Resource!==c?this:void 0;return{as(t){const s=n=>{const i=[];for(const y of r.affectedTables){const l=R.get(y);for(const K of l||[])i.push(K.newRequest())}const o=r.command||t,d=new H(o,n);return u.rpcProvider(i,d),d.promise};return L(m({},e),{[t]:s,defineCommand:D})}}}function J(r,e){return p(new c(r,e))}const f=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(f.key,new f)}static inject(){return O().appContext.provides[f.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await V();const e=this.buffered;this.buffered=[],await u.rpcProvider(e),this.flushing=void 0}};let h=f;a(h,"key",Symbol());class ge{constructor(e,t){a(this,"result",$({loading:!1,data:[],error:void 0}));a(this,"criteria",{});a(this,"version",0);this.resource=e;const s=h.inject(),n=O();_(()=>{t&&(this.criteria=t()),u.hydrate&&!n.isMounted||s.execute(this.newRequest(!n.isMounted))})}newRequest(e){return this.version++,new I(this,!!e)}}class c{constructor(e,t){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=t}clone(){const e=new c(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=m({},this.subResources),e}pick(...e){const t=this.clone();return t.pickedFields=e,p(t)}load(e,t,s,n){const i=this.clone();return i.subResources[e]={single:!0,resource:t,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},p(i)}query(e,t,s,n){const i=this.clone();return i.subResources[e]={resource:t,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},p(i)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function B(r,e){const t=new ge(b(r),e);return O().scope.run(()=>{let s=R.get(r.table);s||R.set(r.table,s=new Set),s.add(t),re(()=>{s.delete(t)})}),t.result}class I{constructor(e,t){a(this,"baseVersion");a(this,"criteria");a(this,"showingLoading");this.query=e,this.showLoading=t,this.baseVersion=e.version,this.criteria=e.criteria,t&&(u.loadingPreDelay?q(u.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await q(u.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class H{constructor(e,t){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=t,this.promise=new Promise((s,n)=>{this.resolve=i=>{this.responded||(this.responded=!0,s(i))},this.reject=i=>{this.responded||(this.responded=!0,n(i))}})}toJSON(){return{command:this.command,args:this.args}}}var A=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:ce,animate:le,pageOf:de,load:fe,query:S,walk:pe,waitNextTick:V,sleep:q,castTo:ye,defineCommand:D,defineResource:J,Resource:c,QueryRequest:I,CommandRequest:H});var me=(r,e)=>{const t=r.__vccOpts||r;for(const[s,n]of e)t[s]=n;return t};const ve=J("article"),we=se({data(){return{color:"black",articles:S(ve,()=>({language:"en"}))}}});function be(r,e,t,s,n,i){return w(),v(x,null,[P("ul",null,[(w(!0),v(x,null,ne(r.articles.data,o=>(w(),v("li",{style:ie({color:r.color})},oe(o.title),5))),256))]),P("button",{onClick:e[0]||(e[0]=o=>r.color="red")},"change color")],64)}var N=me(we,[["render",be]]);async function Re(){const r=T(N);r.use(A,{dehydrate:!0,async rpcProvider(s){s[0]&&s[0].resolve([{title:"Zen and the Art of Motorcycle Maintenance: An Inquiry into Values",language:"en"},{title:"The Hitchhikers Guide to the Galaxy",language:"en"}])}});const e=await ae(r);console.log("server rendered",e),document.getElementById("app").innerHTML=e;const t=T(N);t.use(A,{hydrate:!0,rpcProvider(){throw new Error("demo client can not rpc")}}),t.mount("#app")}Re();
