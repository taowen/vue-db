var Q=Object.defineProperty,z=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var m=(t,e,r)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,v=(t,e)=>{for(var r in e||(e={}))G.call(e,r)&&m(t,r,e[r]);if(S)for(var r of S(e))Z.call(e,r)&&m(t,r,e[r]);return t},j=(t,e)=>z(t,D(e));var a=(t,e,r)=>(m(t,typeof e!="symbol"?e+"":e,r),r);import{r as h,i as q,h as U,t as w,a as W,b as $,g as C,e as _,K as X,c as Y,n as ee,o as te,d as re,f as b,j as T,F as x,k as se,l as g,m as ne,p as oe,q as A,s as ie}from"./vendor.2716932a.js";const ae=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}};ae();const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},R=new Map;function ce(t,e){p.provide(t),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const n=this.$.render;this.$.render=function(...o){let i=n.apply(this,o);if((!q(i)||typeof i.type!="string")&&(i=U("div",i)),c.hydrate)return i;i.props||(i.props={});const f={};for(const[y,l]of Object.entries(w(this.$.data)))W(l)&&l.value&&l.value.data&&(f[y]=l.value.data);return i.props["data-dehydrated"]=JSON.stringify(f),i}}const r=this.$.type;let s=r.instanceCount;s||(s=r.instanceCount=$(0)),s.value++},beforeMount(){var n;if(!c.hydrate)return;const r=(n=this.$el.dataset)==null?void 0:n.dehydrated;if(!r)return;const s=w(this.$.data);for(const[o,i]of Object.entries(JSON.parse(r)))s[o].value={loading:!1,data:i}},async serverPrefetch(){await p.inject().flushing}})}function ue(t,e){_(()=>{const r=e();for(const[s,n]of Object.entries(r))if(typeof n=="object")for(const[o,i]of Object.entries(n))t[s][o]=i;else t[s]=n})}function le(t){return E(t.$).proxy}function E(t){return!t.parent||t.parent.type===X?t:E(t.parent)}function fe(t,e){if(t instanceof u){const r=B(t,e);return Y(()=>{const s=r.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return O(t,e)[0]}function O(t,e){if(t instanceof u)return B(t,e);const r=t;r.instanceCount||(r.instanceCount=$(0)),r.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return k(s,n,r,e),s}function k(t,e,r,s){if(!!e){if(e.component)e.type===r&&de(e.component.proxy,s)&&t.push(e.component.proxy),k(t,e.component.subTree,r,s);else if(Array.isArray(e.children))for(const n of e.children)q(n)&&k(t,n,r,s)}}function de(t,e){if(!e)return!0;for(const[r,s]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==s)return!1}else if(t[r]!==s)return!1;return!0}function pe(t,e,...r){const s=t.$;M(!0,e,r,s)}function F(t,e,r){if(r.component)M(!1,t,e,r.component);else if(Array.isArray(r.children))for(const s of r.children)q(s)&&F(t,e,s)}function M(t,e,r,s){const n=s.proxy;!t&&n[e]?n[e].apply(n,r):F(e,r,s.subTree)}function L(){return new Promise(t=>{ee(t)})}async function he(t){return new Promise(e=>setTimeout(e,t))}function ye(t,e){if(e instanceof u)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function V(t){let e=this&&this.Resource!==u?this:void 0;return{as(r){const s=n=>{const o=[];for(const y of t.affectedTables){const l=R.get(y);for(const K of l||[])o.push(K.newRequest())}const i=t.command||r,f=new H(i,n);return c.rpcProvider(o,f),f.promise};return j(v({},e),{[r]:s,defineCommand:V})}}}function J(t,e){return h(new u(t,e))}const d=class{constructor(){a(this,"buffered",[]);a(this,"flushing")}static provide(e){e.provide(d.key,new d)}static inject(){return C().appContext.provides[d.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await L();const e=this.buffered.map(r=>r.newRequest());this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}};let p=d;a(p,"key",Symbol());class me{constructor(e,r){a(this,"result",$({loading:!1,data:[],error:void 0}));a(this,"criteria",{});a(this,"version",0);this.resource=e;const s=p.inject(),n=C();_(()=>{r&&(this.criteria=r()),c.hydrate&&!n.isMounted||s.execute(this)})}newRequest(){return this.version++,new I(this)}}class u{constructor(e,r){a(this,"pickedFields");a(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new u(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=v({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,h(r)}load(e,r,s,n){const o=this.clone();return o.subResources[e]={single:!0,resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},h(o)}query(e,r,s,n){const o=this.clone();return o.subResources[e]={resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},h(o)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function B(t,e){const r=new me(w(t),e);return C().scope.run(()=>{let s=R.get(t.table);s||R.set(t.table,s=new Set),s.add(r),te(()=>{s.delete(r)})}),r.result}class I{constructor(e){a(this,"baseVersion");a(this,"criteria");this.query=e,this.baseVersion=e.version,this.criteria=e.criteria}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0})}reject(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:[],error:e})}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class H{constructor(e,r){a(this,"promise");a(this,"resolve");a(this,"reject");a(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((s,n)=>{this.resolve=o=>{this.responded||(this.responded=!0,s(o))},this.reject=o=>{this.responded||(this.responded=!0,n(o))}})}toJSON(){return{command:this.command,args:this.args}}}var N=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:ce,animate:ue,pageOf:le,load:fe,query:O,walk:pe,waitNextTick:L,sleep:he,castTo:ye,defineCommand:V,defineResource:J,Resource:u,QueryRequest:I,CommandRequest:H});var ve=(t,e)=>{const r=t.__vccOpts||t;for(const[s,n]of e)r[s]=n;return r};const be=J("article"),ge=re({data(){return{color:"black",articles:O(be,()=>({language:"en"}))}}});function we(t,e,r,s,n,o){return g(),b(x,null,[T("ul",null,[(g(!0),b(x,null,se(t.articles.data,i=>(g(),b("li",{style:ne({color:t.color})},oe(i.title),5))),256))]),T("button",{onClick:e[0]||(e[0]=i=>t.color="red")},"change color")],64)}var P=ve(ge,[["render",we]]);async function Re(){const t=A(P);t.use(N,{dehydrate:!0,async rpcProvider(s){s[0]&&s[0].resolve([{title:"Zen and the Art of Motorcycle Maintenance: An Inquiry into Values",language:"en"},{title:"The Hitchhikers Guide to the Galaxy",language:"en"}])}});const e=await ie(t);console.log("server rendered",e),document.getElementById("app").innerHTML=e;const r=A(P);r.use(N,{hydrate:!0,rpcProvider(){throw new Error("demo client can not rpc")}}),r.mount("#app")}Re();
