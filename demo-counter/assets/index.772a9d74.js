var ee=Object.defineProperty,te=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var q=(t,e,r)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e)=>{for(var r in e||(e={}))se.call(e,r)&&q(t,r,e[r]);if(E)for(var r of E(e))ne.call(e,r)&&q(t,r,e[r]);return t},A=(t,e)=>te(t,re(e));var i=(t,e,r)=>(q(t,typeof e!="symbol"?e+"":e,r),r);import{d as b,c as T,o as p,i as N,h as oe,t as C,a as ie,r as P,K as J,b as ue,n as ae,e as g,g as F,f as ce,j as le,k as de,l as M,m as fe,p as h,w as v,q as Q,s as k,u as he,T as pe,v as ye,x as me,y as ge}from"./vendor.c61d6785.js";const ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}};ve();var w=(t,e)=>{const r=t.__vccOpts||t;for(const[s,n]of e)r[s]=n;return r};const _e=b({data(){return{count:1}},methods:{increase(){this.count+=1}}}),be=["value"];function we(t,e,r,s,n,o){return p(),T("input",{type:"textbox",value:t.count},null,8,be)}var L=w(_e,[["render",we]]);const c={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},R=new Map;function $e(t,e){const r=new _;t.provide(_.key,r),Object.assign(c,e),t.mixin({created(){if(c.dehydrate||c.hydrate){const o=this.$.render;this.$.render=function(...a){let u=o.apply(this,a);if((!N(u)||typeof u.type!="string")&&(u=oe("div",u)),c.hydrate)return u;u.props||(u.props={});const l={},f={};for(const[$,y]of Object.entries(C(this.$.data)))ie(y)&&y.value&&y.value.data&&((y.value.stale?f:l)[$]=y.value.data);return u.props["data-dehydrated"]=JSON.stringify(l),u.props["data-stale"]=JSON.stringify(f),u}}const s=this.$.type;let n=s.instanceCount;n||(n=s.instanceCount=P(0)),n.value++},beforeMount(){var a,u;if(!c.hydrate)return;const s=C(this.$.data),n=JSON.parse(((a=this.$el.dataset)==null?void 0:a.dehydrated)||"{}"),o=JSON.parse(((u=this.$el.dataset)==null?void 0:u.stale)||"{}");for(const l of Object.keys(o))s[l].value._query&&s[l].value._query.refresh();for(const[l,f]of Object.entries(m(m({},n),o)))s[l].value={loading:!1,data:f}},unmounted(){this.$.type.instanceCount.value--},async serverPrefetch(){await r.flushing}})}function S(t){return H(t.$).proxy}function H(t){return!t.parent||t.parent.type===J?t:H(t.parent)}function j(t,e){if(t instanceof d){const r=X(t,e);return ue(()=>{const s=r.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return K(t,e)[0]}function K(t,e){if(t instanceof d)return X(t,e);const r=t;r.instanceCount||(r.instanceCount=P(0)),r.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return x(s,n,r,e),s}function x(t,e,r,s){if(!!e){if(e.component)e.type===r&&qe(e.component.proxy,s)&&t.push(e.component.proxy),x(t,e.component.subTree,r,s);else if(Array.isArray(e.children))for(const n of e.children)N(n)&&x(t,n,r,s)}}function qe(t,e){if(!e)return!0;for(const[r,s]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==s)return!1}else if(t[r]!==s)return!1;return!0}function ke(t,e,...r){const s=t.$;I(!0,e,r,s)}function G(t,e,r){if(r.component)I(!1,t,e,r.component);else if(Array.isArray(r.children))for(const s of r.children)N(s)&&G(t,e,s)}function I(t,e,r,s){const n=s.proxy;!t&&n[e]?n[e].apply(n,r):G(e,r,s.subTree)}function z(){return new Promise(t=>ae(t))}async function O(t){return new Promise(e=>setTimeout(e,t))}function Ce(t,e){if(e instanceof d)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function W(t){let e=this&&this.Resource!==d?this:void 0;return{as(r){const s=n=>{const o=[];for(const l of t.affectedTables){const f=R.get(l);for(const $ of f||[])o.push($.newRequest())}const a=t.command||r,u=new Z(a,n);return c.rpcProvider(o,u),u.promise};return A(m({},e),{[r]:s,defineCommand:W})}}}function Re(t,e){return g(new d(t,e))}class _{constructor(){i(this,"buffered",[]);i(this,"flushing")}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await z();const e=this.buffered;this.buffered=[],await c.rpcProvider(e),this.flushing=void 0}}i(_,"key",Symbol());class xe{constructor(e,r){i(this,"result",P({loading:!1,data:[],error:void 0,_query:this}));i(this,"criteria",{});i(this,"version",0);i(this,"queryBuffer");this.resource=e;const s=F();this.queryBuffer=s.appContext.provides[_.key],le(()=>{r&&(this.criteria=r()),c.hydrate&&!s.isMounted||this.queryBuffer.execute(this.newRequest(!s.isMounted))})}newRequest(e){return this.version++,new Y(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class d{constructor(e,r){i(this,"pickedFields");i(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new d(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=m({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,g(r)}load(e,r,s,n){const o=this.clone();return o.subResources[e]={single:!0,resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},g(o)}query(e,r,s,n){const o=this.clone();return o.subResources[e]={resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},g(o)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function V(t){let e=R.get(t);return e||R.set(t,e=new Set),e}function U(t){var r;let e=((r=t.options)==null?void 0:r.sourceTables)?[t.table,...t.options.sourceTables]:[t.table];for(const s of Object.values(t.subResources))e=[...e,...U(s.resource)];return e}function X(t,e){const r=new xe(C(t),e);return F().scope.run(()=>{const s=U(t);s.forEach(n=>V(n).add(r)),ce(()=>{s.forEach(n=>V(n).delete(r))})}),r.result}class Y{constructor(e,r){i(this,"baseVersion");i(this,"criteria");i(this,"showingLoading");this.query=e,this.showLoading=r,this.baseVersion=e.version,this.criteria=e.criteria,r&&!c.dehydrate&&(c.loadingPreDelay?O(c.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await O(c.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,r){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,r)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:r}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class Z{constructor(e,r){i(this,"promise");i(this,"resolve");i(this,"reject");i(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((s,n)=>{this.resolve=o=>{this.responded||(this.responded=!0,s(o))},this.reject=o=>{this.responded||(this.responded=!0,n(o))}})}toJSON(){return{command:this.command,args:this.args}}}var Oe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:$e,pageOf:S,load:j,query:K,walk:ke,waitNextTick:z,sleep:O,castTo:Ce,defineCommand:W,defineResource:Re,Resource:d,QueryRequest:Y,CommandRequest:Z});const Te=b({methods:{onClicked(){var t;(t=j(L,{$root:S(this)}))==null||t.increase()}}});function Ne(t,e,r,s,n,o){return p(),T("button",{onClick:e[0]||(e[0]=(...a)=>t.onClicked&&t.onClicked(...a))},"+")}var Pe=w(Te,[["render",Ne]]);const Le=b({computed:{displayBack(){const t=j(L,{$root:S(this)});return((t==null?void 0:t.count)||0)+20}}});function Se(t,e,r,s,n,o){return" current is: "+de(t.displayBack)}var je=w(Le,[["render",Se]]);const Be={style:{display:"flex","flex-direction":"row","column-gap":"8px"}},Ee=Q("Go to Counter1"),Ae=Q("Go to Counter2"),D=b({setup(t){return(e,r)=>{const s=M("router-link");return p(),T("div",null,[fe("p",Be,[h(s,{to:"/"},{default:v(()=>[Ee]),_:1}),h(s,{to:"/counter2"},{default:v(()=>[Ae]),_:1})]),h(je),h(L),h(Pe)])}}});const Ve={};function De(t,e){const r=M("router-view");return p(),k(r,null,{default:v(({Component:s,route:n})=>[h(pe,{name:"fade"},{default:v(()=>[(p(),k(J,null,[(p(),k(he(s),{key:n.path}))],1024))]),_:2},1024)]),_:1})}var Je=w(Ve,[["render",De]]);const Fe=[{path:"/",component:D},{path:"/counter2",component:D}],Me=ye({history:me(),routes:Fe}),B=ge(Je);B.use(Me);B.use(Oe);B.mount("#app");
