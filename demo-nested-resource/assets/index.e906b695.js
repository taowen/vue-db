var te=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var k=(r,e,t)=>e in r?te(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,y=(r,e)=>{for(var t in e||(e={}))ne.call(e,t)&&k(r,t,e[t]);if(D)for(var t of D(e))ie.call(e,t)&&k(r,t,e[t]);return r},A=(r,e)=>re(r,se(e));var c=(r,e,t)=>(k(r,typeof e!="symbol"?e+"":e,t),t);import{r as w,i as P,h as oe,t as x,a as ce,b as B,g as N,e as J,K as ae,c as ue,n as de,o as le,d as g,f as h,j as S,k as d,l as V,m as M,F as L,p as E,q as T,s as b,u as fe}from"./vendor.ceb32d51.js";const pe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};pe();const u={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},R=new Map;function he(r,e){m.provide(r),Object.assign(u,e),r.mixin({created(){if(u.dehydrate||u.hydrate){const n=this.$.render;this.$.render=function(...i){let o=n.apply(this,i);if((!P(o)||typeof o.type!="string")&&(o=oe("div",o)),u.hydrate)return o;o.props||(o.props={});const a={},p={};for(const[C,f]of Object.entries(x(this.$.data)))ce(f)&&f.value&&f.value.data&&((f.value.stale?p:a)[C]=f.value.data);return o.props["data-dehydrated"]=JSON.stringify(a),o.props["data-stale"]=JSON.stringify(p),o}}const t=this.$.type;let s=t.instanceCount;s||(s=t.instanceCount=B(0)),s.value++},beforeMount(){var i,o;if(!u.hydrate)return;const t=x(this.$.data),s=JSON.parse(((i=this.$el.dataset)==null?void 0:i.dehydrated)||"{}"),n=JSON.parse(((o=this.$el.dataset)==null?void 0:o.stale)||"{}");for(const a of Object.keys(n))t[a].value._query&&t[a].value._query.refresh();for(const[a,p]of Object.entries(y(y({},s),n)))t[a].value={loading:!1,data:p}},async serverPrefetch(){await m.inject().flushing}})}function ye(r,e){J(()=>{const t=e();for(const[s,n]of Object.entries(t))if(typeof n=="object")for(const[i,o]of Object.entries(n))r[s][i]=o;else r[s]=n})}function ve(r){return I(r.$).proxy}function I(r){return!r.parent||r.parent.type===ae?r:I(r.parent)}function me(r,e){if(r instanceof l){const t=H(r,e);return ue(()=>{const s=t.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return F(r,e)[0]}function F(r,e){if(r instanceof l)return H(r,e);const t=r;t.instanceCount||(t.instanceCount=B(0)),t.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return O(s,n,t,e),s}function O(r,e,t,s){if(!!e){if(e.component)e.type===t&&ge(e.component.proxy,s)&&r.push(e.component.proxy),O(r,e.component.subTree,t,s);else if(Array.isArray(e.children))for(const n of e.children)P(n)&&O(r,n,t,s)}}function ge(r,e){if(!e)return!0;for(const[t,s]of Object.entries(e))if(t==="$parent"){if(r.$.parent.proxy!==s)return!1}else if(r[t]!==s)return!1;return!0}function we(r,e,...t){const s=r.$;Q(!0,e,t,s)}function K(r,e,t){if(t.component)Q(!1,r,e,t.component);else if(Array.isArray(t.children))for(const s of t.children)P(s)&&K(r,e,s)}function Q(r,e,t,s){const n=s.proxy;!r&&n[e]?n[e].apply(n,t):K(e,t,s.subTree)}function z(){return new Promise(r=>{de(r)})}async function j(r){return new Promise(e=>setTimeout(e,r))}function _(r,e){if(e instanceof l)return r;if(r.$.type!==e)throw new Error("type mismatch");return r}function G(r){let e=this&&this.Resource!==l?this:void 0;return{as(t){const s=n=>{const i=[];for(const p of r.affectedTables){const C=R.get(p);for(const f of C||[])i.push(f.newRequest())}const o=r.command||t,a=new W(o,n);return u.rpcProvider(i,a),a.promise};return A(y({},e),{[t]:s,defineCommand:G})}}}function $(r,e){return w(new l(r,e))}const v=class{constructor(){c(this,"buffered",[]);c(this,"flushing")}static provide(e){e.provide(v.key,new v)}static inject(){return N().appContext.provides[v.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await z();const e=this.buffered;this.buffered=[],await u.rpcProvider(e);for(const t of e)await t.showingLoading;this.flushing=void 0}};let m=v;c(m,"key",Symbol());class be{constructor(e,t){c(this,"result",B({loading:!1,data:[],error:void 0,_query:this}));c(this,"criteria",{});c(this,"version",0);c(this,"queryBuffer");this.resource=e,this.queryBuffer=m.inject();const s=N();J(()=>{t&&(this.criteria=t()),u.hydrate&&!s.isMounted||this.queryBuffer.execute(this.newRequest(!s.isMounted))})}newRequest(e){return this.version++,new U(this,!!e)}refresh(){this.queryBuffer.execute(this.newRequest())}}class l{constructor(e,t){c(this,"pickedFields");c(this,"subResources",{});this.table=e,this.options=t}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=y({},this.subResources),e}pick(...e){const t=this.clone();return t.pickedFields=e,w(t)}load(e,t,s,n){const i=this.clone();return i.subResources[e]={single:!0,resource:t,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},w(i)}query(e,t,s,n){const i=this.clone();return i.subResources[e]={resource:t,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},w(i)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function H(r,e){const t=new be(x(r),e);return N().scope.run(()=>{let s=R.get(r.table);s||R.set(r.table,s=new Set),s.add(t),le(()=>{s.delete(t)})}),t.result}class U{constructor(e,t){c(this,"baseVersion");c(this,"criteria");c(this,"showingLoading");this.query=e,this.showLoading=t,this.baseVersion=e.version,this.criteria=e.criteria,t&&(u.loadingPreDelay?j(u.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await j(u.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e,t){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e,t)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0,stale:t}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class W{constructor(e,t){c(this,"promise");c(this,"resolve");c(this,"reject");c(this,"responded",!1);this.command=e,this.args=t,this.promise=new Promise((s,n)=>{this.resolve=i=>{this.responded||(this.responded=!0,s(i))},this.reject=i=>{this.responded||(this.responded=!0,n(i))}})}toJSON(){return{command:this.command,args:this.args}}}var _e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:he,animate:ye,pageOf:ve,load:me,query:F,walk:we,waitNextTick:z,sleep:j,castTo:_,defineCommand:G,defineResource:$,Resource:l,QueryRequest:U,CommandRequest:W}),q=(r,e)=>{const t=r.__vccOpts||r;for(const[s,n]of e)t[s]=n;return t};const X=$("district").pick("name"),$e=g({props:{district:{default:_(void 0,X)}}});function qe(r,e,t,s,n,i){return d(),h("div",null,"District: "+S(r.district.name),1)}var Ce=q($e,[["render",qe]]);const Y=$("city").query("districts",X,{cityId:"$parent.id"}),ke=g({props:{city:{default:_(void 0,Y)}},components:{DistrictBox:Ce}}),xe={style:{"margin-left":"32px"}};function Re(r,e,t,s,n,i){const o=T("DistrictBox");return d(),h("div",null,[V(" City: "+S(r.city.name)+" ",1),M("div",xe,[(d(!0),h(L,null,E(r.city.districts,a=>(d(),b(o,{district:a},null,8,["district"]))),256))])])}var Oe=q(ke,[["render",Re]]);const Z=$("province").query("cities",Y,{provinceId:"$parent.id"}),je=g({props:{province:{default:_(void 0,Z)}},components:{CityBox:Oe}}),Pe={style:{"margin-left":"32px"}};function Be(r,e,t,s,n,i){const o=T("CityBox");return d(),h("div",null,[V(" Province: "+S(r.province.name)+" ",1),M("div",Pe,[(d(!0),h(L,null,E(r.province.cities,a=>(d(),b(o,{city:a},null,8,["city"]))),256))])])}var Ne=q(je,[["render",Be]]);const Se=g({data(){return{provinces:F(Z)}},components:{ProvinceBox:Ne}});function Le(r,e,t,s,n,i){const o=T("ProvinceBox");return d(!0),h(L,null,E(r.provinces.data,a=>(d(),b(o,{province:a},null,8,["province"]))),256)}var Ee=q(Se,[["render",Le]]);const Te=g({setup(r){return(e,t)=>(d(),b(Ee))}}),Fe=async r=>{console.log("queries",JSON.stringify(r,void 0,"  ")),r[0].resolve([{id:"jiangxi",name:"\u6C5F\u897F",cities:[{id:"nanchang",name:"\u5357\u660C",districts:[{id:"xihu",name:"\u897F\u6E56"},{id:"donghu",name:"\u4E1C\u6E56"},{id:"xinjian",name:"\u65B0\u5EFA"}]}]},{id:"jilin",name:"\u5409\u6797"}])},ee=fe(Te);ee.use(_e,{rpcProvider:Fe});ee.mount("#app");
