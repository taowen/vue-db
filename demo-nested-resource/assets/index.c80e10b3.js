var ee=Object.defineProperty,te=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var q=(t,e,r)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,C=(t,e)=>{for(var r in e||(e={}))se.call(e,r)&&q(t,r,e[r]);if(F)for(var r of F(e))ne.call(e,r)&&q(t,r,e[r]);return t},A=(t,e)=>te(t,re(e));var c=(t,e,r)=>(q(t,typeof e!="symbol"?e+"":e,r),r);import{r as v,i as O,h as ie,t as R,a as oe,b as j,g as P,e as D,K as ce,c as ue,n as ae,o as de,d as m,f as p,j as B,k as a,l as V,m as J,F as N,p as S,q as T,s as b,u as le}from"./vendor.ceb32d51.js";const fe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}};fe();const d={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},k=new Map;function pe(t,e){y.provide(t),Object.assign(d,e),t.mixin({created(){if(d.dehydrate||d.hydrate){const s=this.$.render;this.$.render=function(...i){let o=s.apply(this,i);if((!O(o)||typeof o.type!="string")&&(o=ie("div",o)),d.hydrate)return o;o.props||(o.props={});const u={};for(const[w,f]of Object.entries(R(this.$.data)))oe(f)&&f.value&&f.value.data&&(u[w]=f.value.data);return o.props["data-dehydrated"]=JSON.stringify(u),o}}const r=this.$.type;let n=r.instanceCount;n||(n=r.instanceCount=j(0)),n.value++},beforeMount(){var s;if(!d.hydrate)return;const r=(s=this.$el.dataset)==null?void 0:s.dehydrated;if(!r)return;const n=R(this.$.data);for(const[i,o]of Object.entries(JSON.parse(r)))n[i].value={loading:!1,data:o}},async serverPrefetch(){await y.inject().flushing}})}function he(t,e){D(()=>{const r=e();for(const[n,s]of Object.entries(r))if(typeof s=="object")for(const[i,o]of Object.entries(s))t[n][i]=o;else t[n]=s})}function ye(t){return L(t.$).proxy}function L(t){return!t.parent||t.parent.type===ce?t:L(t.parent)}function me(t,e){if(t instanceof l){const r=z(t,e);return ue(()=>{const n=r.value;return{loading:n.loading,data:n.data[0],error:n.error}})}return E(t,e)[0]}function E(t,e){if(t instanceof l)return z(t,e);const r=t;r.instanceCount||(r.instanceCount=j(0)),r.instanceCount.value;const n=[];let s;if(e.$parent)s=e.$parent.$.subTree;else if(e.$root)s=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return x(n,s,r,e),n}function x(t,e,r,n){if(!!e){if(e.component)e.type===r&&ve(e.component.proxy,n)&&t.push(e.component.proxy),x(t,e.component.subTree,r,n);else if(Array.isArray(e.children))for(const s of e.children)O(s)&&x(t,s,r,n)}}function ve(t,e){if(!e)return!0;for(const[r,n]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==n)return!1}else if(t[r]!==n)return!1;return!0}function be(t,e,...r){const n=t.$;I(!0,e,r,n)}function M(t,e,r){if(r.component)I(!1,t,e,r.component);else if(Array.isArray(r.children))for(const n of r.children)O(n)&&M(t,e,n)}function I(t,e,r,n){const s=n.proxy;!t&&s[e]?s[e].apply(s,r):M(e,r,n.subTree)}function K(){return new Promise(t=>{ae(t)})}async function _e(t){return new Promise(e=>setTimeout(e,t))}function _(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function Q(t){let e=this&&this.Resource!==l?this:void 0;return{as(r){const n=s=>{const i=[];for(const w of t.affectedTables){const f=k.get(w);for(const Z of f||[])i.push(Z.newRequest())}const o=t.command||r,u=new H(o,s);return d.rpcProvider(i,u),u.promise};return A(C({},e),{[r]:n,defineCommand:Q})}}}function $(t,e){return v(new l(t,e))}const h=class{constructor(){c(this,"buffered",[]);c(this,"flushing")}static provide(e){e.provide(h.key,new h)}static inject(){return P().appContext.provides[h.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await K();const e=this.buffered.map(r=>r.newRequest());this.buffered=[],await d.rpcProvider(e),this.flushing=void 0}};let y=h;c(y,"key",Symbol());class $e{constructor(e,r){c(this,"result",j({loading:!1,data:[],error:void 0}));c(this,"criteria",{});c(this,"version",0);this.resource=e;const n=y.inject(),s=P();D(()=>{r&&(this.criteria=r()),d.hydrate&&!s.isMounted||n.execute(this)})}newRequest(){return this.version++,new G(this)}}class l{constructor(e,r){c(this,"pickedFields");c(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=C({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,v(r)}load(e,r,n,s){const i=this.clone();return i.subResources[e]={single:!0,resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},v(i)}query(e,r,n,s){const i=this.clone();return i.subResources[e]={resource:r,dynamicCriteria:n,staticCriteria:s==null?void 0:s.staticCriteria},v(i)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function z(t,e){const r=new $e(R(t),e);return P().scope.run(()=>{let n=k.get(t.table);n||k.set(t.table,n=new Set),n.add(r),de(()=>{n.delete(r)})}),r.result}class G{constructor(e){c(this,"baseVersion");c(this,"criteria");this.query=e,this.baseVersion=e.version,this.criteria=e.criteria}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0})}reject(e){this.isExpired||(this.query.version++,this.query.result.value={loading:!1,data:[],error:e})}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class H{constructor(e,r){c(this,"promise");c(this,"resolve");c(this,"reject");c(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((n,s)=>{this.resolve=i=>{this.responded||(this.responded=!0,n(i))},this.reject=i=>{this.responded||(this.responded=!0,s(i))}})}toJSON(){return{command:this.command,args:this.args}}}var ge=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:pe,animate:he,pageOf:ye,load:me,query:E,walk:be,waitNextTick:K,sleep:_e,castTo:_,defineCommand:Q,defineResource:$,Resource:l,QueryRequest:G,CommandRequest:H}),g=(t,e)=>{const r=t.__vccOpts||t;for(const[n,s]of e)r[n]=s;return r};const U=$("district"),we=m({props:{district:{default:_(void 0,U)}}});function qe(t,e,r,n,s,i){return a(),p("div",null," District: "+B(t.district.name),1)}var Ce=g(we,[["render",qe]]);const W=$("city").query("districts",U,{cityId:"$parent.id"}),Re=m({props:{city:{default:_(void 0,W)}},components:{DistrictBox:Ce}}),ke={style:{"margin-left":"32px"}};function xe(t,e,r,n,s,i){const o=T("DistrictBox");return a(),p("div",null,[V(" City: "+B(t.city.name)+" ",1),J("div",ke,[(a(!0),p(N,null,S(t.city.districts,u=>(a(),b(o,{district:u},null,8,["district"]))),256))])])}var Oe=g(Re,[["render",xe]]);const X=$("province").query("cities",W,{provinceId:"$parent.id"}),je=m({props:{province:{default:_(void 0,X)}},components:{CityBox:Oe}}),Pe={style:{"margin-left":"32px"}};function Be(t,e,r,n,s,i){const o=T("CityBox");return a(),p("div",null,[V(" Province: "+B(t.province.name)+" ",1),J("div",Pe,[(a(!0),p(N,null,S(t.province.cities,u=>(a(),b(o,{city:u},null,8,["city"]))),256))])])}var Ne=g(je,[["render",Be]]);const Se=m({data(){return{provinces:E(X)}},components:{ProvinceBox:Ne}});function Te(t,e,r,n,s,i){const o=T("ProvinceBox");return a(!0),p(N,null,S(t.provinces.data,u=>(a(),b(o,{province:u},null,8,["province"]))),256)}var Ee=g(Se,[["render",Te]]);const Fe=m({setup(t){return(e,r)=>(a(),b(Ee))}}),Ae=async t=>{console.log("queries",JSON.stringify(t,void 0,"  ")),t[0].resolve([{id:"jiangxi",name:"\u6C5F\u897F",cities:[{id:"nanchang",name:"\u5357\u660C",districts:[{id:"xihu",name:"\u897F\u6E56"},{id:"donghu",name:"\u4E1C\u6E56"},{id:"xinjian",name:"\u65B0\u5EFA"}]}]},{id:"jilin",name:"\u5409\u6797"}])},Y=le(Fe);Y.use(ge,{rpcProvider:Ae});Y.mount("#app");
