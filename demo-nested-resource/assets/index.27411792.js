var te=Object.defineProperty,re=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var C=(t,e,r)=>e in t?te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q=(t,e)=>{for(var r in e||(e={}))se.call(e,r)&&C(t,r,e[r]);if(F)for(var r of F(e))ie.call(e,r)&&C(t,r,e[r]);return t},D=(t,e)=>re(t,ne(e));var c=(t,e,r)=>(C(t,typeof e!="symbol"?e+"":e,r),r);import{r as v,i as P,h as oe,t as k,a as ce,b as j,g as B,e as A,K as ae,c as ue,n as de,o as le,d as m,f as p,j as L,k as d,l as V,m as J,F as N,p as S,q as E,s as g,u as fe}from"./vendor.ceb32d51.js";const pe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};pe();const u={rpcProvider(){throw new Error("must install with rpcProvider before query or call")}},x=new Map;function he(t,e){y.provide(t),Object.assign(u,e),t.mixin({created(){if(u.dehydrate||u.hydrate){const n=this.$.render;this.$.render=function(...i){let o=n.apply(this,i);if((!P(o)||typeof o.type!="string")&&(o=oe("div",o)),u.hydrate)return o;o.props||(o.props={});const a={};for(const[$,f]of Object.entries(k(this.$.data)))ce(f)&&f.value&&f.value.data&&(a[$]=f.value.data);return o.props["data-dehydrated"]=JSON.stringify(a),o}}const r=this.$.type;let s=r.instanceCount;s||(s=r.instanceCount=j(0)),s.value++},beforeMount(){var n;if(!u.hydrate)return;const r=(n=this.$el.dataset)==null?void 0:n.dehydrated;if(!r)return;const s=k(this.$.data);for(const[i,o]of Object.entries(JSON.parse(r)))s[i].value={loading:!1,data:o}},async serverPrefetch(){await y.inject().flushing}})}function ye(t,e){A(()=>{const r=e();for(const[s,n]of Object.entries(r))if(typeof n=="object")for(const[i,o]of Object.entries(n))t[s][i]=o;else t[s]=n})}function me(t){return M(t.$).proxy}function M(t){return!t.parent||t.parent.type===ae?t:M(t.parent)}function ve(t,e){if(t instanceof l){const r=G(t,e);return ue(()=>{const s=r.value;return{loading:s.loading,data:s.data[0],error:s.error}})}return T(t,e)[0]}function T(t,e){if(t instanceof l)return G(t,e);const r=t;r.instanceCount||(r.instanceCount=j(0)),r.instanceCount.value;const s=[];let n;if(e.$parent)n=e.$parent.$.subTree;else if(e.$root)n=e.$root.$.subTree,delete e.$root;else throw new Error("must provide $parent or $root");return R(s,n,r,e),s}function R(t,e,r,s){if(!!e){if(e.component)e.type===r&&ge(e.component.proxy,s)&&t.push(e.component.proxy),R(t,e.component.subTree,r,s);else if(Array.isArray(e.children))for(const n of e.children)P(n)&&R(t,n,r,s)}}function ge(t,e){if(!e)return!0;for(const[r,s]of Object.entries(e))if(r==="$parent"){if(t.$.parent.proxy!==s)return!1}else if(t[r]!==s)return!1;return!0}function be(t,e,...r){const s=t.$;K(!0,e,r,s)}function I(t,e,r){if(r.component)K(!1,t,e,r.component);else if(Array.isArray(r.children))for(const s of r.children)P(s)&&I(t,e,s)}function K(t,e,r,s){const n=s.proxy;!t&&n[e]?n[e].apply(n,r):I(e,r,s.subTree)}function Q(){return new Promise(t=>{de(t)})}async function O(t){return new Promise(e=>setTimeout(e,t))}function b(t,e){if(e instanceof l)return t;if(t.$.type!==e)throw new Error("type mismatch");return t}function z(t){let e=this&&this.Resource!==l?this:void 0;return{as(r){const s=n=>{const i=[];for(const $ of t.affectedTables){const f=x.get($);for(const ee of f||[])i.push(ee.newRequest())}const o=t.command||r,a=new U(o,n);return u.rpcProvider(i,a),a.promise};return D(q({},e),{[r]:s,defineCommand:z})}}}function w(t,e){return v(new l(t,e))}const h=class{constructor(){c(this,"buffered",[]);c(this,"flushing")}static provide(e){e.provide(h.key,new h)}static inject(){return B().appContext.provides[h.key]}execute(e){this.buffered.push(e),this.buffered.length===1&&(this.flushing=this.flush())}async flush(){await Q();const e=this.buffered;this.buffered=[],await u.rpcProvider(e),this.flushing=void 0}};let y=h;c(y,"key",Symbol());class we{constructor(e,r){c(this,"result",j({loading:!1,data:[],error:void 0}));c(this,"criteria",{});c(this,"version",0);this.resource=e;const s=y.inject(),n=B();A(()=>{r&&(this.criteria=r()),u.hydrate&&!n.isMounted||s.execute(this.newRequest(!n.isMounted))})}newRequest(e){return this.version++,new H(this,!!e)}}class l{constructor(e,r){c(this,"pickedFields");c(this,"subResources",{});this.table=e,this.options=r}clone(){const e=new l(this.table,this.options);return e.pickedFields=this.pickedFields,e.subResources=q({},this.subResources),e}pick(...e){const r=this.clone();return r.pickedFields=e,v(r)}load(e,r,s,n){const i=this.clone();return i.subResources[e]={single:!0,resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},v(i)}query(e,r,s,n){const i=this.clone();return i.subResources[e]={resource:r,dynamicCriteria:s,staticCriteria:n==null?void 0:n.staticCriteria},v(i)}toJSON(){var e;return{table:this.table,staticCriteria:(e=this.options)==null?void 0:e.staticCriteria,subResources:Object.keys(this.subResources).length===0?void 0:this.subResources}}}function G(t,e){const r=new we(k(t),e);return B().scope.run(()=>{let s=x.get(t.table);s||x.set(t.table,s=new Set),s.add(r),le(()=>{s.delete(r)})}),r.result}class H{constructor(e,r){c(this,"baseVersion");c(this,"criteria");c(this,"showingLoading");this.query=e,this.showLoading=r,this.baseVersion=e.version,this.criteria=e.criteria,r&&(u.loadingPreDelay?O(u.loadingPreDelay||0).then(()=>{this.showingLoading=this.loadingCountdown()}):this.showingLoading=this.loadingCountdown())}async loadingCountdown(){this.isExpired||(this.query.result.value={loading:!0,data:[],error:void 0},await O(u.loadingPostDelay||0))}get resource(){return this.query.resource}get isExpired(){return this.baseVersion!==this.query.version}resolve(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.resolve(e)});return}this.query.version++,this.query.result.value={loading:!1,data:e,error:void 0}}}reject(e){if(!this.isExpired){if(this.showingLoading){this.showingLoading.then(()=>{this.showingLoading=void 0,this.reject(e)});return}this.query.version++,this.query.result.value={loading:!1,data:[],error:e}}}toJSON(){return{resource:this.resource,criteria:this.criteria}}}class U{constructor(e,r){c(this,"promise");c(this,"resolve");c(this,"reject");c(this,"responded",!1);this.command=e,this.args=r,this.promise=new Promise((s,n)=>{this.resolve=i=>{this.responded||(this.responded=!0,s(i))},this.reject=i=>{this.responded||(this.responded=!0,n(i))}})}toJSON(){return{command:this.command,args:this.args}}}var _e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",install:he,animate:ye,pageOf:me,load:ve,query:T,walk:be,waitNextTick:Q,sleep:O,castTo:b,defineCommand:z,defineResource:w,Resource:l,QueryRequest:H,CommandRequest:U}),_=(t,e)=>{const r=t.__vccOpts||t;for(const[s,n]of e)r[s]=n;return r};const W=w("district").pick("name"),$e=m({props:{district:{default:b(void 0,W)}}});function Ce(t,e,r,s,n,i){return d(),p("div",null,"District: "+L(t.district.name),1)}var qe=_($e,[["render",Ce]]);const X=w("city").query("districts",W,{cityId:"$parent.id"}),ke=m({props:{city:{default:b(void 0,X)}},components:{DistrictBox:qe}}),xe={style:{"margin-left":"32px"}};function Re(t,e,r,s,n,i){const o=E("DistrictBox");return d(),p("div",null,[V(" City: "+L(t.city.name)+" ",1),J("div",xe,[(d(!0),p(N,null,S(t.city.districts,a=>(d(),g(o,{district:a},null,8,["district"]))),256))])])}var Oe=_(ke,[["render",Re]]);const Y=w("province").query("cities",X,{provinceId:"$parent.id"}),Pe=m({props:{province:{default:b(void 0,Y)}},components:{CityBox:Oe}}),je={style:{"margin-left":"32px"}};function Be(t,e,r,s,n,i){const o=E("CityBox");return d(),p("div",null,[V(" Province: "+L(t.province.name)+" ",1),J("div",je,[(d(!0),p(N,null,S(t.province.cities,a=>(d(),g(o,{city:a},null,8,["city"]))),256))])])}var Le=_(Pe,[["render",Be]]);const Ne=m({data(){return{provinces:T(Y)}},components:{ProvinceBox:Le}});function Se(t,e,r,s,n,i){const o=E("ProvinceBox");return d(!0),p(N,null,S(t.provinces.data,a=>(d(),g(o,{province:a},null,8,["province"]))),256)}var Ee=_(Ne,[["render",Se]]);const Te=m({setup(t){return(e,r)=>(d(),g(Ee))}}),Fe=async t=>{console.log("queries",JSON.stringify(t,void 0,"  ")),t[0].resolve([{id:"jiangxi",name:"\u6C5F\u897F",cities:[{id:"nanchang",name:"\u5357\u660C",districts:[{id:"xihu",name:"\u897F\u6E56"},{id:"donghu",name:"\u4E1C\u6E56"},{id:"xinjian",name:"\u65B0\u5EFA"}]}]},{id:"jilin",name:"\u5409\u6797"}])},Z=fe(Te);Z.use(_e,{rpcProvider:Fe});Z.mount("#app");
